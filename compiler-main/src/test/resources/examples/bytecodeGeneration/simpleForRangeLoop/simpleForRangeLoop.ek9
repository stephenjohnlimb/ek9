#!ek9
<?-
  Bytecode test for simple for-range loop.
  Tests polymorphic dispatch, direction detection, and loop iteration.
  Should iterate 1...10 and print sum (55).
-?>
defines module bytecode.test

  defines program

    @BYTECODE: CODE_GENERATION_AGGREGATES: TYPE: "bytecode.test::SimpleForRangeLoop": `public class bytecode.test.SimpleForRangeLoop {
  static {};
    Code:
         0: return

  private void i_init();
    Code:
         0: return

  public bytecode.test.SimpleForRangeLoop();
    Code:
         0: aload_0
         1: invokespecial #CP                 // Method java/lang/Object."<init>":()V
         4: aload_0
         5: invokevirtual #CP                 // Method i_init:()V
         8: return

  public void _main();
    Code:
         0: aconst_null
         1: astore_1
         2: new           #CP                 // class org/ek9/lang/Stdout
         5: dup
         6: invokespecial #CP                 // Method org/ek9/lang/Stdout."<init>":()V
         9: astore_2
        10: aload_2
        11: astore_1
        12: aconst_null
        13: astore_3
        14: iconst_0
        15: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
        18: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
        21: astore        4
        23: aload         4
        25: astore_3
        26: iconst_1
        27: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
        30: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
        33: astore        5
        35: aload         5
        37: astore        6
        39: bipush        10
        41: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
        44: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
        47: astore        7
        49: aload         7
        51: astore        8
        53: aload         6
        55: invokevirtual #CP                 // Method org/ek9/lang/Integer._isSet:()Lorg/ek9/lang/Boolean;
        58: astore        9
        60: aload         9
        62: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
        65: istore        10
        67: iload         10
        69: ifne          82
        72: new           #CP                 // class java/lang/AssertionError
        75: dup
        76: ldc           #CP                 // String Assertion failed
        78: invokespecial #CP                 // Method java/lang/AssertionError."<init>":(Ljava/lang/Object;)V
        81: athrow
        82: aload         8
        84: invokevirtual #CP                 // Method org/ek9/lang/Integer._isSet:()Lorg/ek9/lang/Boolean;
        87: astore        11
        89: aload         11
        91: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
        94: istore        12
        96: iload         12
        98: ifne          111
       101: new           #CP                 // class java/lang/AssertionError
       104: dup
       105: ldc           #CP                 // String Assertion failed
       107: invokespecial #CP                 // Method java/lang/AssertionError."<init>":(Ljava/lang/Object;)V
       110: athrow
       111: aload         6
       113: aload         8
       115: invokevirtual #CP                 // Method org/ek9/lang/Integer._cmp:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Integer;
       118: astore        13
       120: aload         6
       122: astore        14
       124: iconst_0
       125: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
       128: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
       131: astore        15
       133: aload         13
       135: aload         15
       137: invokevirtual #CP                 // Method org/ek9/lang/Integer._lt:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Boolean;
       140: astore        16
       142: aload         16
       144: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
       147: istore        17
       149: iload         17
       151: ifne          210
       154: iconst_0
       155: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
       158: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
       161: astore        18
       163: aload         13
       165: aload         18
       167: invokevirtual #CP                 // Method org/ek9/lang/Integer._gt:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Boolean;
       170: astore        19
       172: aload         19
       174: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
       177: istore        20
       179: iload         20
       181: ifne          289
       184: aload         14
       186: astore        21
       188: aload_3
       189: astore        22
       191: aload         21
       193: astore        23
       195: aload         22
       197: aload         23
       199: invokevirtual #CP                 // Method org/ek9/lang/Integer._add:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Integer;
       202: astore        24
       204: aload         24
       206: astore_3
       207: goto          365
       210: aload         14
       212: aload         8
       214: invokevirtual #CP                 // Method org/ek9/lang/Integer._cmp:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Integer;
       217: astore        25
       219: iconst_0
       220: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
       223: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
       226: astore        26
       228: aload         25
       230: aload         26
       232: invokevirtual #CP                 // Method org/ek9/lang/Integer._lteq:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Boolean;
       235: astore        27
       237: aload         27
       239: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
       242: istore        28
       244: iload         28
       246: ifeq          365
       249: aload         14
       251: astore        21
       253: aload_3
       254: astore        22
       256: aload         21
       258: astore        23
       260: aload         22
       262: aload         23
       264: invokevirtual #CP                 // Method org/ek9/lang/Integer._add:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Integer;
       267: astore        24
       269: aload         24
       271: astore_3
       272: aload         14
       274: invokevirtual #CP                 // Method org/ek9/lang/Integer._inc:()Lorg/ek9/lang/Integer;
       277: astore        29
       279: aload         29
       281: astore        14
       283: goto          210
       286: nop
       287: nop
       288: athrow
       289: aload         14
       291: aload         8
       293: invokevirtual #CP                 // Method org/ek9/lang/Integer._cmp:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Integer;
       296: astore        30
       298: iconst_0
       299: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
       302: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
       305: astore        31
       307: aload         30
       309: aload         31
       311: invokevirtual #CP                 // Method org/ek9/lang/Integer._gteq:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Boolean;
       314: astore        32
       316: aload         32
       318: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
       321: istore        33
       323: iload         33
       325: ifeq          365
       328: aload         14
       330: astore        21
       332: aload_3
       333: astore        22
       335: aload         21
       337: astore        23
       339: aload         22
       341: aload         23
       343: invokevirtual #CP                 // Method org/ek9/lang/Integer._add:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Integer;
       346: astore        24
       348: aload         24
       350: astore_3
       351: aload         14
       353: invokevirtual #CP                 // Method org/ek9/lang/Integer._dec:()Lorg/ek9/lang/Integer;
       356: astore        34
       358: aload         34
       360: astore        14
       362: goto          289
       365: aload_1
       366: astore        35
       368: aload_3
       369: astore        36
       371: aload         35
       373: aload         36
       375: invokeinterface #CP,  2           // InterfaceMethod org/ek9/lang/StringOutput.println:(Lorg/ek9/lang/Any;)V
       380: return
}`

    SimpleForRangeLoop()
      stdout <- Stdout()
      sum <- 0

      for i in 1 ... 10
        sum: sum + i

      // Print final value - should be 55
      stdout.println(sum)

//EOF
