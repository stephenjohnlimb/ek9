#!ek9
<?-
  Bytecode test for simple for-range loop.
  Tests polymorphic dispatch, direction detection, and loop iteration.
  Should iterate 1...10 and print sum (55).
-?>
defines module bytecode.test

  defines program

    @BYTECODE: CODE_GENERATION_AGGREGATES: TYPE: "bytecode.test::SimpleForRangeLoop": `public class bytecode.test.SimpleForRangeLoop {
  public bytecode.test.SimpleForRangeLoop();
    Code:
         0: aload_0
         1: invokespecial #CP                  // Method java/lang/Object."<init>":()V
         4: aload_0
         5: invokevirtual #CP                 // Method i_init:()V
         8: return

  public void _main();
    Code:
         0: aconst_null
         1: astore_1
         2: new           #CP                 // class org/ek9/lang/Stdout
         5: dup
         6: invokespecial #CP                 // Method org/ek9/lang/Stdout."<init>":()V
         9: astore_2
        10: aload_2
        11: astore_1
        12: aconst_null
        13: astore_3
        14: iconst_0
        15: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
        18: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
        21: astore        4
        23: aload         4
        25: astore_3
        26: aconst_null
        27: astore        5
        29: iconst_1
        30: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
        33: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
        36: astore        6
        38: aload         6
        40: astore        7
        42: bipush        10
        44: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
        47: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
        50: astore        8
        52: aload         8
        54: astore        9
        56: aload         7
        58: invokevirtual #CP                 // Method org/ek9/lang/Integer._isSet:()Lorg/ek9/lang/Boolean;
        61: astore        10
        63: aload         10
        65: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
        68: istore        11
        70: iload         11
        72: ifne          85
        75: new           #CP                 // class java/lang/AssertionError
        78: dup
        79: ldc           #CP                 // String For-range \'start\' value must be set
        81: invokespecial #CP                 // Method java/lang/AssertionError."<init>":(Ljava/lang/Object;)V
        84: athrow
        85: aload         9
        87: invokevirtual #CP                 // Method org/ek9/lang/Integer._isSet:()Lorg/ek9/lang/Boolean;
        90: astore        12
        92: aload         12
        94: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
        97: istore        13
        99: iload         13
       101: ifne          114
       104: new           #CP                 // class java/lang/AssertionError
       107: dup
       108: ldc           #CP                 // String For-range \'end\' value must be set
       110: invokespecial #CP                 // Method java/lang/AssertionError."<init>":(Ljava/lang/Object;)V
       113: athrow
       114: aload         7
       116: aload         9
       118: invokevirtual #CP                 // Method org/ek9/lang/Integer._cmp:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Integer;
       121: astore        14
       123: aload         7
       125: astore        15
       127: iconst_0
       128: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
       131: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
       134: astore        16
       136: aload         14
       138: aload         16
       140: invokevirtual #CP                 // Method org/ek9/lang/Integer._lt:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Boolean;
       143: astore        17
       145: aload         17
       147: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
       150: istore        18
       152: iload         18
       154: ifne          243
       157: iconst_0
       158: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
       161: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
       164: astore        19
       166: aload         14
       168: aload         19
       170: invokevirtual #CP                 // Method org/ek9/lang/Integer._gt:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Boolean;
       173: astore        20
       175: aload         20
       177: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
       180: istore        21
       182: iload         21
       184: ifne          322
       187: iconst_0
       188: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
       191: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
       194: astore        22
       196: aload         14
       198: aload         22
       200: invokevirtual #CP                 // Method org/ek9/lang/Integer._eq:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Boolean;
       203: astore        23
       205: aload         23
       207: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
       210: istore        24
       212: iload         24
       214: ifeq          398
       217: aload         15
       219: astore        5
       221: aload_3
       222: astore        25
       224: aload         5
       226: astore        26
       228: aload         25
       230: aload         26
       232: invokevirtual #CP                 // Method org/ek9/lang/Integer._add:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Integer;
       235: astore        27
       237: aload         27
       239: astore_3
       240: goto          398
       243: aload         15
       245: aload         9
       247: invokevirtual #CP                 // Method org/ek9/lang/Integer._cmp:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Integer;
       250: astore        28
       252: iconst_0
       253: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
       256: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
       259: astore        29
       261: aload         28
       263: aload         29
       265: invokevirtual #CP                 // Method org/ek9/lang/Integer._lteq:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Boolean;
       268: astore        30
       270: aload         30
       272: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
       275: istore        31
       277: iload         31
       279: ifeq          398
       282: aload         15
       284: astore        5
       286: aload_3
       287: astore        25
       289: aload         5
       291: astore        26
       293: aload         25
       295: aload         26
       297: invokevirtual #CP                 // Method org/ek9/lang/Integer._add:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Integer;
       300: astore        27
       302: aload         27
       304: astore_3
       305: aload         15
       307: invokevirtual #CP                 // Method org/ek9/lang/Integer._inc:()Lorg/ek9/lang/Integer;
       310: astore        32
       312: aload         32
       314: astore        15
       316: goto          243
       319: nop
       320: nop
       321: athrow
       322: aload         15
       324: aload         9
       326: invokevirtual #CP                 // Method org/ek9/lang/Integer._cmp:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Integer;
       329: astore        33
       331: iconst_0
       332: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
       335: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
       338: astore        34
       340: aload         33
       342: aload         34
       344: invokevirtual #CP                 // Method org/ek9/lang/Integer._gteq:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Boolean;
       347: astore        35
       349: aload         35
       351: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
       354: istore        36
       356: iload         36
       358: ifeq          398
       361: aload         15
       363: astore        5
       365: aload_3
       366: astore        25
       368: aload         5
       370: astore        26
       372: aload         25
       374: aload         26
       376: invokevirtual #CP                 // Method org/ek9/lang/Integer._add:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Integer;
       379: astore        27
       381: aload         27
       383: astore_3
       384: aload         15
       386: invokevirtual #CP                 // Method org/ek9/lang/Integer._dec:()Lorg/ek9/lang/Integer;
       389: astore        37
       391: aload         37
       393: astore        15
       395: goto          322
       398: aload_1
       399: astore        38
       401: aload_3
       402: astore        39
       404: aload         38
       406: aload         39
       408: invokeinterface #CP,  2           // InterfaceMethod org/ek9/lang/StringOutput.println:(Lorg/ek9/lang/Any;)V
       413: return

  static {};
    Code:
         0: return

  private void i_init();
    Code:
         0: return
}`

    SimpleForRangeLoop()
      stdout <- Stdout()
      sum <- 0

      for i in 1 ... 10
        sum: sum + i

      // Print final value - should be 55
      stdout.println(sum)

//EOF
