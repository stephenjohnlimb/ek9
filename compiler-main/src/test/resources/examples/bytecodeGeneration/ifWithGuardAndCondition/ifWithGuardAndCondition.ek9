#!ek9
<?-
  Bytecode test for if statement with guard AND explicit condition.
  Tests guard variable pattern: if value <- expr with condition
  Guard checks isSet, condition checks explicit boolean.
  Both must be true (AND logic) for body to execute.
-?>
defines module bytecode.test

  defines program

    @BYTECODE: CODE_GENERATION_AGGREGATES: TYPE: "bytecode.test::IfWithGuardAndCondition": `public class bytecode.test.IfWithGuardAndCondition {
  static {};
    Code:
         0: return

  private void i_init();
    Code:
         0: return

  public bytecode.test.IfWithGuardAndCondition();
    Code:
         0: aload_0
         1: invokespecial #CP                 // Method java/lang/Object."<init>":()V
         4: aload_0
         5: invokevirtual #CP                 // Method i_init:()V
         8: return

  public void _main(org.ek9.lang.Integer);
    Code:
         0: aconst_null
         1: astore_2
         2: new           #CP                 // class org/ek9/lang/Stdout
         5: dup
         6: invokespecial #CP                 // Method org/ek9/lang/Stdout."<init>":()V
         9: astore_3
        10: aload_3
        11: astore_2
        12: aconst_null
        13: astore        4
        15: new           #CP                 // class org/ek9/lang/_Optional_C011A3DC69C147B21BB3B4318CD6E648E5B36284DE9A0658F8CDDD33D8C1B5BC
        18: dup
        19: invokespecial #CP                 // Method org/ek9/lang/_Optional_C011A3DC69C147B21BB3B4318CD6E648E5B36284DE9A0658F8CDDD33D8C1B5BC."<init>":()V
        22: astore        5
        24: aload         5
        26: astore        4
        28: aload_1
        29: astore        6
        31: iconst_1
        32: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
        35: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
        38: astore        7
        40: aload         6
        42: aload         7
        44: invokevirtual #CP                 // Method org/ek9/lang/Integer._eq:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Boolean;
        47: astore        8
        49: aload         8
        51: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
        54: istore        9
        56: iload         9
        58: ifeq          86
        61: ldc           #CP                 // String Alpha
        63: invokestatic  #CP                 // Method org/ek9/lang/String._of:(Ljava/lang/String;)Lorg/ek9/lang/String;
        66: astore        10
        68: new           #CP                 // class org/ek9/lang/_Optional_C011A3DC69C147B21BB3B4318CD6E648E5B36284DE9A0658F8CDDD33D8C1B5BC
        71: dup
        72: aload         10
        74: invokespecial #CP                 // Method org/ek9/lang/_Optional_C011A3DC69C147B21BB3B4318CD6E648E5B36284DE9A0658F8CDDD33D8C1B5BC."<init>":(Lorg/ek9/lang/String;)V
        77: astore        11
        79: aload         11
        81: astore        4
        83: goto          144
        86: aload_1
        87: astore        12
        89: iconst_2
        90: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
        93: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
        96: astore        13
        98: aload         12
       100: aload         13
       102: invokevirtual #CP                 // Method org/ek9/lang/Integer._eq:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Boolean;
       105: astore        14
       107: aload         14
       109: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
       112: istore        15
       114: iload         15
       116: ifeq          144
       119: ldc           #CP                 // String Gamma
       121: invokestatic  #CP                 // Method org/ek9/lang/String._of:(Ljava/lang/String;)Lorg/ek9/lang/String;
       124: astore        16
       126: new           #CP                 // class org/ek9/lang/_Optional_C011A3DC69C147B21BB3B4318CD6E648E5B36284DE9A0658F8CDDD33D8C1B5BC
       129: dup
       130: aload         16
       132: invokespecial #CP                 // Method org/ek9/lang/_Optional_C011A3DC69C147B21BB3B4318CD6E648E5B36284DE9A0658F8CDDD33D8C1B5BC."<init>":(Lorg/ek9/lang/String;)V
       135: astore        17
       137: aload         17
       139: astore        4
       141: goto          144
       144: aconst_null
       145: astore        18
       147: ldc           #CP                 // String Beta
       149: invokestatic  #CP                 // Method org/ek9/lang/String._of:(Ljava/lang/String;)Lorg/ek9/lang/String;
       152: astore        19
       154: aload         19
       156: astore        18
       158: aconst_null
       159: astore        20
       161: aload         4
       163: astore        21
       165: aload         21
       167: astore        20
       169: aload         20
       171: astore        22
       173: aload         22
       175: invokevirtual #CP                 // Method org/ek9/lang/_Optional_C011A3DC69C147B21BB3B4318CD6E648E5B36284DE9A0658F8CDDD33D8C1B5BC._isSet:()Lorg/ek9/lang/Boolean;
       178: astore        23
       180: aload         23
       182: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
       185: istore        24
       187: iload         24
       189: ifeq          292
       192: aconst_null
       193: astore        25
       195: aload         20
       197: astore        26
       199: aload         26
       201: invokevirtual #CP                 // Method org/ek9/lang/_Optional_C011A3DC69C147B21BB3B4318CD6E648E5B36284DE9A0658F8CDDD33D8C1B5BC.get:()Lorg/ek9/lang/String;
       204: astore        27
       206: aload         27
       208: astore        25
       210: aload         25
       212: astore        28
       214: aload         18
       216: astore        29
       218: aload         28
       220: aload         29
       222: invokevirtual #CP                 // Method org/ek9/lang/String._gt:(Lorg/ek9/lang/String;)Lorg/ek9/lang/Boolean;
       225: astore        30
       227: aload         30
       229: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
       232: istore        31
       234: iload         31
       236: ifeq          272
       239: aload_2
       240: astore        32
       242: ldc           #CP                 // String Got value > threshold:
       244: invokestatic  #CP                 // Method org/ek9/lang/String._of:(Ljava/lang/String;)Lorg/ek9/lang/String;
       247: astore        33
       249: aload         25
       251: astore        34
       253: aload         33
       255: aload         34
       257: invokevirtual #CP                 // Method org/ek9/lang/String._add:(Lorg/ek9/lang/String;)Lorg/ek9/lang/String;
       260: astore        35
       262: aload         32
       264: aload         35
       266: invokevirtual #CP                 // Method org/ek9/lang/Stdout.println:(Lorg/ek9/lang/String;)V
       269: goto          289
       272: aload_2
       273: astore        36
       275: ldc           #CP                 // String Got value <= threshold
       277: invokestatic  #CP                 // Method org/ek9/lang/String._of:(Ljava/lang/String;)Lorg/ek9/lang/String;
       280: astore        37
       282: aload         36
       284: aload         37
       286: invokevirtual #CP                 // Method org/ek9/lang/Stdout.println:(Lorg/ek9/lang/String;)V
       289: goto          309
       292: aload_2
       293: astore        38
       295: ldc           #CP                 // String No value
       297: invokestatic  #CP                 // Method org/ek9/lang/String._of:(Ljava/lang/String;)Lorg/ek9/lang/String;
       300: astore        39
       302: aload         38
       304: aload         39
       306: invokevirtual #CP                 // Method org/ek9/lang/Stdout.println:(Lorg/ek9/lang/String;)V
       309: aload_2
       310: astore        40
       312: ldc           #CP                 // String Done
       314: invokestatic  #CP                 // Method org/ek9/lang/String._of:(Ljava/lang/String;)Lorg/ek9/lang/String;
       317: astore        41
       319: aload         40
       321: aload         41
       323: invokevirtual #CP                 // Method org/ek9/lang/Stdout.println:(Lorg/ek9/lang/String;)V
       326: return
}`
    IfWithGuardAndCondition()
      -> testCase as Integer

      stdout <- Stdout()

      // Create Optional based on testCase
      // testCase 0: unset Optional (guard fails)
      // testCase 1: Optional("Alpha") - guard succeeds, condition fails ("Alpha" < "Beta")
      // testCase 2: Optional("Gamma") - guard succeeds, condition succeeds ("Gamma" > "Beta")
      optionalValue <- Optional() of String

      if testCase == 1
        optionalValue: Optional("Alpha")
      else if testCase == 2
        optionalValue: Optional("Gamma")

      threshold <- "Beta"

      // Guard AND condition pattern: if value <- optionalValue with condition
      // Need to extract the value first, then check condition
      if value <- optionalValue
        extracted <- value.get()
        if extracted > threshold
          stdout.println("Got value > threshold: " + extracted)
        else
          stdout.println("Got value <= threshold")
      else
        stdout.println("No value")

      stdout.println("Done")

//EOF
