#!ek9
<?-
  Bytecode test for if statement with guard AND explicit condition.
  Tests guard variable pattern: if value <- expr with condition
  Guard checks isSet, condition checks explicit boolean.
  Both must be true (AND logic) for body to execute.
-?>
defines module bytecode.test

  defines program

    @BYTECODE: CODE_GENERATION_AGGREGATES: TYPE: "bytecode.test::IfWithGuardAndCondition": `public class bytecode.test.IfWithGuardAndCondition {
  static {};
    Code:
         0: return

  private void i_init();
    Code:
         0: return

  public bytecode.test.IfWithGuardAndCondition();
    Code:
         0: aload_0
         1: invokespecial #CP                 // Method java/lang/Object."<init>":()V
         4: aload_0
         5: invokevirtual #CP                 // Method i_init:()V
         8: return

  public void _main(org.ek9.lang.Integer);
    Code:
         0: aconst_null
         1: astore_2
         2: new           #CP                 // class org/ek9/lang/Stdout
         5: dup
         6: invokespecial #CP                 // Method org/ek9/lang/Stdout."<init>":()V
         9: astore_3
        10: aload_3
        11: astore_2
        12: aconst_null
        13: astore        4
        15: new           #CP                 // class org/ek9/lang/String
        18: dup
        19: invokespecial #CP                 // Method org/ek9/lang/String."<init>":()V
        22: astore        5
        24: aload         5
        26: astore        4
        28: aload_1
        29: astore        6
        31: iconst_1
        32: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
        35: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
        38: astore        7
        40: aload         6
        42: aload         7
        44: invokevirtual #CP                 // Method org/ek9/lang/Integer._eq:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Boolean;
        47: astore        8
        49: aload         8
        51: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
        54: istore        9
        56: iload         9
        58: ifeq          75
        61: ldc           #CP                 // String Alpha
        63: invokestatic  #CP                 // Method org/ek9/lang/String._of:(Ljava/lang/String;)Lorg/ek9/lang/String;
        66: astore        10
        68: aload         10
        70: astore        4
        72: goto          122
        75: aload_1
        76: astore        11
        78: iconst_2
        79: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
        82: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
        85: astore        12
        87: aload         11
        89: aload         12
        91: invokevirtual #CP                 // Method org/ek9/lang/Integer._eq:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Boolean;
        94: astore        13
        96: aload         13
        98: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
       101: istore        14
       103: iload         14
       105: ifeq          122
       108: ldc           #CP                 // String Gamma
       110: invokestatic  #CP                 // Method org/ek9/lang/String._of:(Ljava/lang/String;)Lorg/ek9/lang/String;
       113: astore        15
       115: aload         15
       117: astore        4
       119: goto          122
       122: aconst_null
       123: astore        16
       125: ldc           #CP                 // String Beta
       127: invokestatic  #CP                 // Method org/ek9/lang/String._of:(Ljava/lang/String;)Lorg/ek9/lang/String;
       130: astore        17
       132: aload         17
       134: astore        16
       136: aconst_null
       137: astore        18
       139: aload         4
       141: astore        19
       143: aload         19
       145: astore        18
       147: aload         18
       149: ifnull        156
       152: iconst_0
       153: goto          157
       156: iconst_1
       157: istore        20
       159: iload         20
       161: ifeq          176
       164: invokestatic  #CP                 // Method org/ek9/lang/Boolean._ofFalse:()Lorg/ek9/lang/Boolean;
       167: astore        21
       169: aload         21
       171: astore        22
       173: goto          191
       176: aload         18
       178: astore        23
       180: aload         23
       182: invokevirtual #CP                 // Method org/ek9/lang/String._isSet:()Lorg/ek9/lang/Boolean;
       185: astore        24
       187: aload         24
       189: astore        22
       191: aload         22
       193: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
       196: istore        25
       198: iload         25
       200: ifeq          236
       203: aload         18
       205: astore        26
       207: aload         16
       209: astore        27
       211: aload         26
       213: aload         27
       215: invokevirtual #CP                 // Method org/ek9/lang/String._gt:(Lorg/ek9/lang/String;)Lorg/ek9/lang/Boolean;
       218: astore        28
       220: aload         22
       222: aload         28
       224: invokevirtual #CP                 // Method org/ek9/lang/Boolean._and:(Lorg/ek9/lang/Boolean;)Lorg/ek9/lang/Boolean;
       227: astore        29
       229: aload         29
       231: astore        30
       233: goto          240
       236: aload         22
       238: astore        30
       240: aload         30
       242: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
       245: istore        31
       247: iload         31
       249: ifeq          292
       252: aload_2
       253: astore        32
       255: ldc           #CP                 // String Got value > threshold:
       257: invokestatic  #CP                 // Method org/ek9/lang/String._of:(Ljava/lang/String;)Lorg/ek9/lang/String;
       260: astore        33
       262: aload         18
       264: astore        34
       266: aload         34
       268: invokevirtual #CP                 // Method org/ek9/lang/String._string:()Lorg/ek9/lang/String;
       271: astore        35
       273: aload         33
       275: aload         35
       277: invokevirtual #CP                 // Method org/ek9/lang/String._add:(Lorg/ek9/lang/String;)Lorg/ek9/lang/String;
       280: astore        36
       282: aload         32
       284: aload         36
       286: invokevirtual #CP                 // Method org/ek9/lang/Stdout.println:(Lorg/ek9/lang/String;)V
       289: goto          309
       292: aload_2
       293: astore        37
       295: ldc           #CP                 // String No value or value <= threshold
       297: invokestatic  #CP                 // Method org/ek9/lang/String._of:(Ljava/lang/String;)Lorg/ek9/lang/String;
       300: astore        38
       302: aload         37
       304: aload         38
       306: invokevirtual #CP                 // Method org/ek9/lang/Stdout.println:(Lorg/ek9/lang/String;)V
       309: aload_2
       310: astore        39
       312: ldc           #CP                 // String Done
       314: invokestatic  #CP                 // Method org/ek9/lang/String._of:(Ljava/lang/String;)Lorg/ek9/lang/String;
       317: astore        40
       319: aload         39
       321: aload         40
       323: invokevirtual #CP                 // Method org/ek9/lang/Stdout.println:(Lorg/ek9/lang/String;)V
       326: return
}`
    IfWithGuardAndCondition()
      -> testCase as Integer

      stdout <- Stdout()

      // Create optional String value based on testCase
      // testCase 0: unset String (guard fails)
      // testCase 1: "Alpha" - guard succeeds, condition fails ("Alpha" < "Beta")
      // testCase 2: "Gamma" - guard succeeds, condition succeeds ("Gamma" > "Beta")
      optionalValue <- String()

      if testCase == 1
        optionalValue: "Alpha"
      else if testCase == 2
        optionalValue: "Gamma"

      threshold <- "Beta"

      // Guard AND condition pattern: if value <- optionalValue with condition
      // Uses "with" keyword to combine guard + condition in single expression
      // Short-circuit: condition only evaluated if guard succeeds (value is set)
      if value <- optionalValue with value > threshold
        stdout.println("Got value > threshold: " + $value)
      else
        stdout.println("No value or value <= threshold")

      stdout.println("Done")

//EOF
