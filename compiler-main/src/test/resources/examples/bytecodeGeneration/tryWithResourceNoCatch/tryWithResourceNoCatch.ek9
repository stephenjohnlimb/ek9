#!ek9
<?-
  Bytecode test for try-with-resource statement (no catch, no finally).
  Tests implicit resource cleanup without explicit catch or finally handlers.
  Resource close() is called automatically via implicit finally.
-?>
defines module bytecode.test

  defines class

    TestResource

      TestResource()
        -> resourceName as String
        assert resourceName?

      operator close as pure
        stdout <- Stdout()
        stdout.println("Closing resource")

      override operator ? as pure
        <- rtn <- true

  defines program

    @BYTECODE: CODE_GENERATION_AGGREGATES: TYPE: "bytecode.test::TryWithResourceNoCatch":`public class bytecode.test.TryWithResourceNoCatch {
  public bytecode.test.TryWithResourceNoCatch();
    Code:
         0: aload_0
         1: invokespecial #CP                  // Method java/lang/Object."<init>":()V
         4: aload_0
         5: invokevirtual #CP                 // Method i_init:()V
         8: return

  public void _main();
    Code:
         0: aconst_null
         1: astore_1
         2: ldc           #CP                 // String test
         4: invokestatic  #CP                 // Method org/ek9/lang/String._of:(Ljava/lang/String;)Lorg/ek9/lang/String;
         7: astore_2
         8: new           #CP                 // class bytecode/test/TestResource
        11: dup
        12: aload_2
        13: invokespecial #CP                 // Method bytecode/test/TestResource."<init>":(Lorg/ek9/lang/String;)V
        16: astore_3
        17: aload_3
        18: astore_1
        19: aconst_null
        20: astore        4
        22: aconst_null
        23: astore        5
        25: new           #CP                 // class org/ek9/lang/Stdout
        28: dup
        29: invokespecial #CP                 // Method org/ek9/lang/Stdout."<init>":()V
        32: astore        6
        34: aload         6
        36: astore        5
        38: aload         5
        40: astore        7
        42: ldc           #CP                 // String Using resource
        44: invokestatic  #CP                 // Method org/ek9/lang/String._of:(Ljava/lang/String;)Lorg/ek9/lang/String;
        47: astore        8
        49: aload         7
        51: aload         8
        53: invokevirtual #CP                 // Method org/ek9/lang/Stdout.println:(Lorg/ek9/lang/String;)V
        56: goto          64
        59: astore        4
        61: goto          64
        64: aload_1
        65: invokevirtual #CP                 // Method bytecode/test/TestResource._close:()V
        68: aload         4
        70: ifnull        76
        73: aload         4
        75: athrow
        76: return
      Exception table:
         from    to  target type
            22    56    59   any

  static {};
    Code:
         0: return

  private void i_init();
    Code:
         0: return
}`
    TryWithResourceNoCatch()

      try
        -> resource <- TestResource("test")
        stdout <- Stdout()
        stdout.println("Using resource")

//EOF
