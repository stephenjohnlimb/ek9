#!ek9
<?-
  Bytecode test for complete try/catch/finally statement.
  All three parts present: try block, catch handler, finally block.
  Tests exception handling with finally duplication.
-?>
defines module bytecode.test

  defines program

    @BYTECODE: CODE_GENERATION_AGGREGATES: TYPE: "bytecode.test::TryCatchFinally":`public class bytecode.test.TryCatchFinally {
  public bytecode.test.TryCatchFinally();
    Code:
         0: aload_0
         1: invokespecial #CP                  // Method java/lang/Object."<init>":()V
         4: aload_0
         5: invokevirtual #CP                 // Method i_init:()V
         8: return

  public void _main();
    Code:
         0: aconst_null
         1: astore_1
         2: new           #CP                 // class org/ek9/lang/Stdout
         5: dup
         6: invokespecial #CP                 // Method org/ek9/lang/Stdout."<init>":()V
         9: astore_2
        10: aload_2
        11: astore_1
        12: aconst_null
        13: astore_3
        14: aload_1
        15: astore        4
        17: ldc           #CP                 // String Try block executing
        19: invokestatic  #CP                 // Method org/ek9/lang/String._of:(Ljava/lang/String;)Lorg/ek9/lang/String;
        22: astore        5
        24: aload         4
        26: aload         5
        28: invokevirtual #CP                 // Method org/ek9/lang/Stdout.println:(Lorg/ek9/lang/String;)V
        31: aconst_null
        32: astore        6
        34: bipush        42
        36: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
        39: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
        42: astore        7
        44: aload         7
        46: astore        6
        48: aload_1
        49: astore        8
        51: aload         6
        53: astore        9
        55: aload         8
        57: aload         9
        59: invokeinterface #CP,  2           // InterfaceMethod org/ek9/lang/StringOutput.println:(Lorg/ek9/lang/Any;)V
        64: goto          94
        67: astore        10
        69: aload_1
        70: astore        11
        72: ldc           #CP                 // String Catch block executing
        74: invokestatic  #CP                 // Method org/ek9/lang/String._of:(Ljava/lang/String;)Lorg/ek9/lang/String;
        77: astore        12
        79: aload         11
        81: aload         12
        83: invokevirtual #CP                 // Method org/ek9/lang/Stdout.println:(Lorg/ek9/lang/String;)V
        86: goto          94
        89: athrow
        90: astore_3
        91: goto          94
        94: aload_1
        95: astore        13
        97: ldc           #CP                 // String Finally block executing
        99: invokestatic  #CP                 // Method org/ek9/lang/String._of:(Ljava/lang/String;)Lorg/ek9/lang/String;
       102: astore        14
       104: aload         13
       106: aload         14
       108: invokevirtual #CP                 // Method org/ek9/lang/Stdout.println:(Lorg/ek9/lang/String;)V
       111: aload_3
       112: ifnull        117
       115: aload_3
       116: athrow
       117: return
      Exception table:
         from    to  target type
            14    64    67   Class org/ek9/lang/Exception
            94   117    89   Class org/ek9/lang/Exception
            14    89    90   any

  static {};
    Code:
         0: return

  private void i_init();
    Code:
         0: return
}`
    TryCatchFinally()
      stdout <- Stdout()

      try
        stdout.println("Try block executing")
        value <- 42
        stdout.println(value)
      catch
        -> ex as Exception
        stdout.println("Catch block executing")
      finally
        stdout.println("Finally block executing")

//EOF
