#!ek9
<?-
  Bytecode test for for-range expression form.
  Expression form: result <- for i in start ... end <- rtn <- initialValue
  The for-range returns a value through the rtn variable (accumulator pattern).

  This program computes the sum of integers from 1 to limit.
  For limit=5: sum = 1 + 2 + 3 + 4 + 5 = 15
-?>
defines module bytecode.test.forrangeexpr

  defines program

    @BYTECODE: CODE_GENERATION_AGGREGATES: TYPE: "bytecode.test.forrangeexpr::ForRangeExpression": `public class bytecode.test.forrangeexpr.ForRangeExpression {
  public bytecode.test.forrangeexpr.ForRangeExpression();
    Code:
         0: aload_0
         1: invokespecial #CP                  // Method java/lang/Object."<init>":()V
         4: aload_0
         5: invokevirtual #CP                 // Method i_init:()V
         8: return

  public void _main(org.ek9.lang.Integer);
    Code:
         0: aconst_null
         1: astore_2
         2: new           #CP                 // class org/ek9/lang/Stdout
         5: dup
         6: invokespecial #CP                 // Method org/ek9/lang/Stdout."<init>":()V
         9: astore_3
        10: aload_3
        11: astore_2
        12: aconst_null
        13: astore        4
        15: aconst_null
        16: astore        5
        18: iconst_0
        19: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
        22: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
        25: astore        6
        27: aload         6
        29: astore        5
        31: aconst_null
        32: astore        7
        34: iconst_1
        35: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
        38: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
        41: astore        8
        43: aload         8
        45: astore        9
        47: aload_1
        48: astore        10
        50: aload         10
        52: astore        11
        54: aload         9
        56: invokevirtual #CP                 // Method org/ek9/lang/Integer._isSet:()Lorg/ek9/lang/Boolean;
        59: astore        12
        61: aload         12
        63: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
        66: istore        13
        68: iload         13
        70: ifne          83
        73: new           #CP                 // class java/lang/AssertionError
        76: dup
        77: ldc           #CP                 // String For-range \'start\' value must be set
        79: invokespecial #CP                 // Method java/lang/AssertionError."<init>":(Ljava/lang/Object;)V
        82: athrow
        83: aload         11
        85: invokevirtual #CP                 // Method org/ek9/lang/Integer._isSet:()Lorg/ek9/lang/Boolean;
        88: astore        14
        90: aload         14
        92: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
        95: istore        15
        97: iload         15
        99: ifne          112
       102: new           #CP                 // class java/lang/AssertionError
       105: dup
       106: ldc           #CP                 // String For-range \'end\' value must be set
       108: invokespecial #CP                 // Method java/lang/AssertionError."<init>":(Ljava/lang/Object;)V
       111: athrow
       112: aload         9
       114: aload         11
       116: invokevirtual #CP                 // Method org/ek9/lang/Integer._cmp:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Integer;
       119: astore        16
       121: aload         9
       123: astore        17
       125: iconst_0
       126: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
       129: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
       132: astore        18
       134: aload         16
       136: aload         18
       138: invokevirtual #CP                 // Method org/ek9/lang/Integer._lt:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Boolean;
       141: astore        19
       143: aload         19
       145: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
       148: istore        20
       150: iload         20
       152: ifne          243
       155: iconst_0
       156: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
       159: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
       162: astore        21
       164: aload         16
       166: aload         21
       168: invokevirtual #CP                 // Method org/ek9/lang/Integer._gt:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Boolean;
       171: astore        22
       173: aload         22
       175: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
       178: istore        23
       180: iload         23
       182: ifne          324
       185: iconst_0
       186: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
       189: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
       192: astore        24
       194: aload         16
       196: aload         24
       198: invokevirtual #CP                 // Method org/ek9/lang/Integer._eq:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Boolean;
       201: astore        25
       203: aload         25
       205: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
       208: istore        26
       210: iload         26
       212: ifeq          402
       215: aload         17
       217: astore        7
       219: aload         5
       221: astore        27
       223: aload         7
       225: astore        28
       227: aload         27
       229: aload         28
       231: invokevirtual #CP                 // Method org/ek9/lang/Integer._add:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Integer;
       234: astore        29
       236: aload         29
       238: astore        5
       240: goto          402
       243: aload         17
       245: aload         11
       247: invokevirtual #CP                 // Method org/ek9/lang/Integer._cmp:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Integer;
       250: astore        30
       252: iconst_0
       253: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
       256: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
       259: astore        31
       261: aload         30
       263: aload         31
       265: invokevirtual #CP                 // Method org/ek9/lang/Integer._lteq:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Boolean;
       268: astore        32
       270: aload         32
       272: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
       275: istore        33
       277: iload         33
       279: ifeq          402
       282: aload         17
       284: astore        7
       286: aload         5
       288: astore        27
       290: aload         7
       292: astore        28
       294: aload         27
       296: aload         28
       298: invokevirtual #CP                 // Method org/ek9/lang/Integer._add:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Integer;
       301: astore        29
       303: aload         29
       305: astore        5
       307: aload         17
       309: invokevirtual #CP                 // Method org/ek9/lang/Integer._inc:()Lorg/ek9/lang/Integer;
       312: astore        34
       314: aload         34
       316: astore        17
       318: goto          243
       321: nop
       322: nop
       323: athrow
       324: aload         17
       326: aload         11
       328: invokevirtual #CP                 // Method org/ek9/lang/Integer._cmp:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Integer;
       331: astore        35
       333: iconst_0
       334: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
       337: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
       340: astore        36
       342: aload         35
       344: aload         36
       346: invokevirtual #CP                 // Method org/ek9/lang/Integer._gteq:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Boolean;
       349: astore        37
       351: aload         37
       353: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
       356: istore        38
       358: iload         38
       360: ifeq          402
       363: aload         17
       365: astore        7
       367: aload         5
       369: astore        27
       371: aload         7
       373: astore        28
       375: aload         27
       377: aload         28
       379: invokevirtual #CP                 // Method org/ek9/lang/Integer._add:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Integer;
       382: astore        29
       384: aload         29
       386: astore        5
       388: aload         17
       390: invokevirtual #CP                 // Method org/ek9/lang/Integer._dec:()Lorg/ek9/lang/Integer;
       393: astore        39
       395: aload         39
       397: astore        17
       399: goto          324
       402: aload         5
       404: astore        40
       406: aload         40
       408: astore        4
       410: aload_2
       411: astore        41
       413: aload         4
       415: astore        42
       417: aload         41
       419: aload         42
       421: invokeinterface #CP,  2           // InterfaceMethod org/ek9/lang/StringOutput.println:(Lorg/ek9/lang/Any;)V
       426: aload_2
       427: astore        43
       429: ldc           #CP                 // String Done
       431: invokestatic  #CP                 // Method org/ek9/lang/String._of:(Ljava/lang/String;)Lorg/ek9/lang/String;
       434: astore        44
       436: aload         43
       438: aload         44
       440: invokevirtual #CP                 // Method org/ek9/lang/Stdout.println:(Lorg/ek9/lang/String;)V
       443: return

  static {};
    Code:
         0: return

  private void i_init();
    Code:
         0: return
}`

    ForRangeExpression()
      -> limit as Integer

      stdout <- Stdout()

      // For-range expression that accumulates sum from 1 to limit
      result <- for i in 1 ... limit
        <- rtn <- 0
        rtn: rtn + i

      // Print the result (accumulated sum)
      stdout.println(result)

      // Always print to verify program continues
      stdout.println("Done")

//EOF
