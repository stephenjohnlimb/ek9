#!ek9
<?-
  Bytecode test for for-range statement with guard variable.
  Tests guard variable pattern: for limit <- expr then i in 1 ... limit
  Guard is evaluated once, if set the loop iterates from 1 to limit.
-?>
defines module bytecode.test.forrangeguard

  defines program

    @BYTECODE: CODE_GENERATION_AGGREGATES: TYPE: "bytecode.test.forrangeguard::ForRangeWithGuard": `public class bytecode.test.forrangeguard.ForRangeWithGuard {
  public bytecode.test.forrangeguard.ForRangeWithGuard();
    Code:
         0: aload_0
         1: invokespecial #CP                  // Method java/lang/Object."<init>":()V
         4: aload_0
         5: invokevirtual #CP                 // Method i_init:()V
         8: return

  public void _main(org.ek9.lang.Integer);
    Code:
         0: aconst_null
         1: astore_2
         2: new           #CP                 // class org/ek9/lang/Stdout
         5: dup
         6: invokespecial #CP                 // Method org/ek9/lang/Stdout."<init>":()V
         9: astore_3
        10: aload_3
        11: astore_2
        12: aconst_null
        13: astore        4
        15: iconst_0
        16: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
        19: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
        22: astore        5
        24: aload         5
        26: astore        4
        28: aconst_null
        29: astore        6
        31: new           #CP                 // class org/ek9/lang/Integer
        34: dup
        35: invokespecial #CP                 // Method org/ek9/lang/Integer."<init>":()V
        38: astore        7
        40: aload         7
        42: astore        6
        44: aload_1
        45: astore        8
        47: iconst_0
        48: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
        51: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
        54: astore        9
        56: aload         8
        58: aload         9
        60: invokevirtual #CP                 // Method org/ek9/lang/Integer._gt:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Boolean;
        63: astore        10
        65: aload         10
        67: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
        70: istore        11
        72: iload         11
        74: ifeq          98
        77: aload_1
        78: astore        12
        80: new           #CP                 // class org/ek9/lang/Integer
        83: dup
        84: aload         12
        86: invokespecial #CP                 // Method org/ek9/lang/Integer."<init>":(Lorg/ek9/lang/Integer;)V
        89: astore        13
        91: aload         13
        93: astore        6
        95: goto          98
        98: aconst_null
        99: astore        14
       101: aload         6
       103: astore        15
       105: aload         15
       107: astore        14
       109: aload         14
       111: ifnull        118
       114: iconst_0
       115: goto          119
       118: iconst_1
       119: istore        16
       121: iload         16
       123: ifeq          138
       126: invokestatic  #CP                 // Method org/ek9/lang/Boolean._ofFalse:()Lorg/ek9/lang/Boolean;
       129: astore        17
       131: aload         17
       133: astore        18
       135: goto          153
       138: aload         14
       140: astore        19
       142: aload         19
       144: invokevirtual #CP                 // Method org/ek9/lang/Integer._isSet:()Lorg/ek9/lang/Boolean;
       147: astore        20
       149: aload         20
       151: astore        18
       153: aload         18
       155: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
       158: istore        21
       160: iload         21
       162: ifeq          759
       165: aconst_null
       166: astore        22
       168: iconst_1
       169: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
       172: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
       175: astore        23
       177: aload         23
       179: astore        24
       181: aload         14
       183: astore        25
       185: aload         25
       187: astore        26
       189: aload         24
       191: invokevirtual #CP                 // Method org/ek9/lang/Integer._isSet:()Lorg/ek9/lang/Boolean;
       194: astore        27
       196: aload         27
       198: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
       201: istore        28
       203: iload         28
       205: ifne          218
       208: new           #CP                 // class java/lang/AssertionError
       211: dup
       212: ldc           #CP                 // String For-range \'start\' value must be set
       214: invokespecial #CP                 // Method java/lang/AssertionError."<init>":(Ljava/lang/Object;)V
       217: athrow
       218: aload         26
       220: invokevirtual #CP                 // Method org/ek9/lang/Integer._isSet:()Lorg/ek9/lang/Boolean;
       223: astore        29
       225: aload         29
       227: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
       230: istore        30
       232: iload         30
       234: ifne          247
       237: new           #CP                 // class java/lang/AssertionError
       240: dup
       241: ldc           #CP                 // String For-range \'end\' value must be set
       243: invokespecial #CP                 // Method java/lang/AssertionError."<init>":(Ljava/lang/Object;)V
       246: athrow
       247: aload         24
       249: aload         26
       251: invokevirtual #CP                 // Method org/ek9/lang/Integer._cmp:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Integer;
       254: astore        31
       256: aload         24
       258: astore        32
       260: iconst_0
       261: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
       264: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
       267: astore        33
       269: aload         31
       271: aload         33
       273: invokevirtual #CP                 // Method org/ek9/lang/Integer._lt:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Boolean;
       276: astore        34
       278: aload         34
       280: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
       283: istore        35
       285: iload         35
       287: ifne          451
       290: iconst_0
       291: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
       294: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
       297: astore        36
       299: aload         31
       301: aload         36
       303: invokevirtual #CP                 // Method org/ek9/lang/Integer._gt:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Boolean;
       306: astore        37
       308: aload         37
       310: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
       313: istore        38
       315: iload         38
       317: ifne          605
       320: iconst_0
       321: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
       324: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
       327: astore        39
       329: aload         31
       331: aload         39
       333: invokevirtual #CP                 // Method org/ek9/lang/Integer._eq:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Boolean;
       336: astore        40
       338: aload         40
       340: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
       343: istore        41
       345: iload         41
       347: ifeq          756
       350: aload         32
       352: astore        22
       354: aload         4
       356: astore        42
       358: aload         22
       360: astore        43
       362: aload         42
       364: aload         43
       366: invokevirtual #CP                 // Method org/ek9/lang/Integer._add:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Integer;
       369: astore        44
       371: aload         44
       373: astore        4
       375: aload_2
       376: astore        45
       378: ldc           #CP                 // String i=
       380: invokestatic  #CP                 // Method org/ek9/lang/String._of:(Ljava/lang/String;)Lorg/ek9/lang/String;
       383: astore        46
       385: aload         22
       387: astore        47
       389: aload         47
       391: invokevirtual #CP                 // Method org/ek9/lang/Integer._string:()Lorg/ek9/lang/String;
       394: astore        48
       396: aload         46
       398: aload         48
       400: invokevirtual #CP                 // Method org/ek9/lang/String._add:(Lorg/ek9/lang/String;)Lorg/ek9/lang/String;
       403: astore        49
       405: ldc           #CP                 // String  sum=
       407: invokestatic  #CP                 // Method org/ek9/lang/String._of:(Ljava/lang/String;)Lorg/ek9/lang/String;
       410: astore        50
       412: aload         49
       414: aload         50
       416: invokevirtual #CP                 // Method org/ek9/lang/String._add:(Lorg/ek9/lang/String;)Lorg/ek9/lang/String;
       419: astore        51
       421: aload         4
       423: astore        52
       425: aload         52
       427: invokevirtual #CP                 // Method org/ek9/lang/Integer._string:()Lorg/ek9/lang/String;
       430: astore        53
       432: aload         51
       434: aload         53
       436: invokevirtual #CP                 // Method org/ek9/lang/String._add:(Lorg/ek9/lang/String;)Lorg/ek9/lang/String;
       439: astore        54
       441: aload         45
       443: aload         54
       445: invokevirtual #CP                 // Method org/ek9/lang/Stdout.println:(Lorg/ek9/lang/String;)V
       448: goto          756
       451: aload         32
       453: aload         26
       455: invokevirtual #CP                 // Method org/ek9/lang/Integer._cmp:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Integer;
       458: astore        55
       460: iconst_0
       461: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
       464: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
       467: astore        56
       469: aload         55
       471: aload         56
       473: invokevirtual #CP                 // Method org/ek9/lang/Integer._lteq:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Boolean;
       476: astore        57
       478: aload         57
       480: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
       483: istore        58
       485: iload         58
       487: ifeq          756
       490: aload         32
       492: astore        22
       494: aload         4
       496: astore        42
       498: aload         22
       500: astore        43
       502: aload         42
       504: aload         43
       506: invokevirtual #CP                 // Method org/ek9/lang/Integer._add:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Integer;
       509: astore        44
       511: aload         44
       513: astore        4
       515: aload_2
       516: astore        45
       518: ldc           #CP                 // String i=
       520: invokestatic  #CP                 // Method org/ek9/lang/String._of:(Ljava/lang/String;)Lorg/ek9/lang/String;
       523: astore        46
       525: aload         22
       527: astore        47
       529: aload         47
       531: invokevirtual #CP                 // Method org/ek9/lang/Integer._string:()Lorg/ek9/lang/String;
       534: astore        48
       536: aload         46
       538: aload         48
       540: invokevirtual #CP                 // Method org/ek9/lang/String._add:(Lorg/ek9/lang/String;)Lorg/ek9/lang/String;
       543: astore        49
       545: ldc           #CP                 // String  sum=
       547: invokestatic  #CP                 // Method org/ek9/lang/String._of:(Ljava/lang/String;)Lorg/ek9/lang/String;
       550: astore        50
       552: aload         49
       554: aload         50
       556: invokevirtual #CP                 // Method org/ek9/lang/String._add:(Lorg/ek9/lang/String;)Lorg/ek9/lang/String;
       559: astore        51
       561: aload         4
       563: astore        52
       565: aload         52
       567: invokevirtual #CP                 // Method org/ek9/lang/Integer._string:()Lorg/ek9/lang/String;
       570: astore        53
       572: aload         51
       574: aload         53
       576: invokevirtual #CP                 // Method org/ek9/lang/String._add:(Lorg/ek9/lang/String;)Lorg/ek9/lang/String;
       579: astore        54
       581: aload         45
       583: aload         54
       585: invokevirtual #CP                 // Method org/ek9/lang/Stdout.println:(Lorg/ek9/lang/String;)V
       588: aload         32
       590: invokevirtual #CP                 // Method org/ek9/lang/Integer._inc:()Lorg/ek9/lang/Integer;
       593: astore        59
       595: aload         59
       597: astore        32
       599: goto          451
       602: nop
       603: nop
       604: athrow
       605: aload         32
       607: aload         26
       609: invokevirtual #CP                 // Method org/ek9/lang/Integer._cmp:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Integer;
       612: astore        60
       614: iconst_0
       615: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
       618: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
       621: astore        61
       623: aload         60
       625: aload         61
       627: invokevirtual #CP                // Method org/ek9/lang/Integer._gteq:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Boolean;
       630: astore        62
       632: aload         62
       634: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
       637: istore        63
       639: iload         63
       641: ifeq          756
       644: aload         32
       646: astore        22
       648: aload         4
       650: astore        42
       652: aload         22
       654: astore        43
       656: aload         42
       658: aload         43
       660: invokevirtual #CP                 // Method org/ek9/lang/Integer._add:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Integer;
       663: astore        44
       665: aload         44
       667: astore        4
       669: aload_2
       670: astore        45
       672: ldc           #CP                 // String i=
       674: invokestatic  #CP                 // Method org/ek9/lang/String._of:(Ljava/lang/String;)Lorg/ek9/lang/String;
       677: astore        46
       679: aload         22
       681: astore        47
       683: aload         47
       685: invokevirtual #CP                 // Method org/ek9/lang/Integer._string:()Lorg/ek9/lang/String;
       688: astore        48
       690: aload         46
       692: aload         48
       694: invokevirtual #CP                 // Method org/ek9/lang/String._add:(Lorg/ek9/lang/String;)Lorg/ek9/lang/String;
       697: astore        49
       699: ldc           #CP                 // String  sum=
       701: invokestatic  #CP                 // Method org/ek9/lang/String._of:(Ljava/lang/String;)Lorg/ek9/lang/String;
       704: astore        50
       706: aload         49
       708: aload         50
       710: invokevirtual #CP                 // Method org/ek9/lang/String._add:(Lorg/ek9/lang/String;)Lorg/ek9/lang/String;
       713: astore        51
       715: aload         4
       717: astore        52
       719: aload         52
       721: invokevirtual #CP                 // Method org/ek9/lang/Integer._string:()Lorg/ek9/lang/String;
       724: astore        53
       726: aload         51
       728: aload         53
       730: invokevirtual #CP                 // Method org/ek9/lang/String._add:(Lorg/ek9/lang/String;)Lorg/ek9/lang/String;
       733: astore        54
       735: aload         45
       737: aload         54
       739: invokevirtual #CP                 // Method org/ek9/lang/Stdout.println:(Lorg/ek9/lang/String;)V
       742: aload         32
       744: invokevirtual #CP                // Method org/ek9/lang/Integer._dec:()Lorg/ek9/lang/Integer;
       747: astore        64
       749: aload         64
       751: astore        32
       753: goto          605
       756: goto          759
       759: aload_2
       760: astore        65
       762: ldc           #CP                // String Total:
       764: invokestatic  #CP                 // Method org/ek9/lang/String._of:(Ljava/lang/String;)Lorg/ek9/lang/String;
       767: astore        66
       769: aload         4
       771: astore        67
       773: aload         67
       775: invokevirtual #CP                 // Method org/ek9/lang/Integer._string:()Lorg/ek9/lang/String;
       778: astore        68
       780: aload         66
       782: aload         68
       784: invokevirtual #CP                 // Method org/ek9/lang/String._add:(Lorg/ek9/lang/String;)Lorg/ek9/lang/String;
       787: astore        69
       789: aload         65
       791: aload         69
       793: invokevirtual #CP                 // Method org/ek9/lang/Stdout.println:(Lorg/ek9/lang/String;)V
       796: aload_2
       797: astore        70
       799: ldc           #CP                // String Done
       801: invokestatic  #CP                 // Method org/ek9/lang/String._of:(Ljava/lang/String;)Lorg/ek9/lang/String;
       804: astore        71
       806: aload         70
       808: aload         71
       810: invokevirtual #CP                 // Method org/ek9/lang/Stdout.println:(Lorg/ek9/lang/String;)V
       813: return

  static {};
    Code:
         0: return

  private void i_init();
    Code:
         0: return
}`

    ForRangeWithGuard()
      -> maxRange as Integer

      stdout <- Stdout()
      sum <- 0

      // Compute the limit inline (simulating function result)
      exprValue <- Integer()
      if maxRange > 0
        exprValue: Integer(maxRange)

      // For-range loop with guard - guard checked once, then loop iterates
      for limit <- exprValue then i in 1 ... limit
        sum := sum + i
        stdout.println("i=" + $i + " sum=" + $sum)

      stdout.println("Total: " + $sum)
      stdout.println("Done")

//EOF
