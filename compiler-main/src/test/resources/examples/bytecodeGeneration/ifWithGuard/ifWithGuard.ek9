#!ek9
<?-
  Bytecode test for if statement with guard only (implicit isSet check).
  Tests guard variable pattern: if value <- expr
  No explicit boolean condition - just tests if guard variable is set.
-?>
defines module bytecode.test

  defines program

    @BYTECODE: CODE_GENERATION_AGGREGATES: TYPE: "bytecode.test::IfWithGuard": `public class bytecode.test.IfWithGuard {
  public bytecode.test.IfWithGuard();
    Code:
         0: aload_0
         1: invokespecial #CP                  // Method java/lang/Object."<init>":()V
         4: aload_0
         5: invokevirtual #CP                 // Method i_init:()V
         8: return

  public void _main(org.ek9.lang.Integer);
    Code:
         0: aconst_null
         1: astore_2
         2: new           #CP                 // class org/ek9/lang/Stdout
         5: dup
         6: invokespecial #CP                 // Method org/ek9/lang/Stdout."<init>":()V
         9: astore_3
        10: aload_3
        11: astore_2
        12: aconst_null
        13: astore        4
        15: new           #CP                 // class org/ek9/lang/_Optional_C011A3DC69C147B21BB3B4318CD6E648E5B36284DE9A0658F8CDDD33D8C1B5BC
        18: dup
        19: invokespecial #CP                 // Method org/ek9/lang/_Optional_C011A3DC69C147B21BB3B4318CD6E648E5B36284DE9A0658F8CDDD33D8C1B5BC."<init>":()V
        22: astore        5
        24: aload         5
        26: astore        4
        28: aload_1
        29: astore        6
        31: iconst_0
        32: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
        35: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
        38: astore        7
        40: aload         6
        42: aload         7
        44: invokevirtual #CP                 // Method org/ek9/lang/Integer._gt:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Boolean;
        47: astore        8
        49: aload         8
        51: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
        54: istore        9
        56: iload         9
        58: ifeq          86
        61: ldc           #CP                 // String TestValue
        63: invokestatic  #CP                 // Method org/ek9/lang/String._of:(Ljava/lang/String;)Lorg/ek9/lang/String;
        66: astore        10
        68: new           #CP                 // class org/ek9/lang/_Optional_C011A3DC69C147B21BB3B4318CD6E648E5B36284DE9A0658F8CDDD33D8C1B5BC
        71: dup
        72: aload         10
        74: invokespecial #CP                 // Method org/ek9/lang/_Optional_C011A3DC69C147B21BB3B4318CD6E648E5B36284DE9A0658F8CDDD33D8C1B5BC."<init>":(Lorg/ek9/lang/String;)V
        77: astore        11
        79: aload         11
        81: astore        4
        83: goto          86
        86: aconst_null
        87: astore        12
        89: aload         4
        91: astore        13
        93: aload         13
        95: astore        12
        97: aload         12
        99: ifnull        106
       102: iconst_0
       103: goto          107
       106: iconst_1
       107: istore        14
       109: iload         14
       111: ifeq          126
       114: invokestatic  #CP                 // Method org/ek9/lang/Boolean._ofFalse:()Lorg/ek9/lang/Boolean;
       117: astore        15
       119: aload         15
       121: astore        16
       123: goto          141
       126: aload         12
       128: astore        17
       130: aload         17
       132: invokevirtual #CP                 // Method org/ek9/lang/_Optional_C011A3DC69C147B21BB3B4318CD6E648E5B36284DE9A0658F8CDDD33D8C1B5BC._isSet:()Lorg/ek9/lang/Boolean;
       135: astore        18
       137: aload         18
       139: astore        16
       141: aload         16
       143: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
       146: istore        19
       148: iload         19
       150: ifeq          204
       153: aconst_null
       154: astore        20
       156: aload         12
       158: astore        21
       160: aload         21
       162: invokevirtual #CP                 // Method org/ek9/lang/_Optional_C011A3DC69C147B21BB3B4318CD6E648E5B36284DE9A0658F8CDDD33D8C1B5BC.get:()Lorg/ek9/lang/String;
       165: astore        22
       167: aload         22
       169: astore        20
       171: aload_2
       172: astore        23
       174: ldc           #CP                 // String Got value:
       176: invokestatic  #CP                 // Method org/ek9/lang/String._of:(Ljava/lang/String;)Lorg/ek9/lang/String;
       179: astore        24
       181: aload         20
       183: astore        25
       185: aload         24
       187: aload         25
       189: invokevirtual #CP                 // Method org/ek9/lang/String._add:(Lorg/ek9/lang/String;)Lorg/ek9/lang/String;
       192: astore        26
       194: aload         23
       196: aload         26
       198: invokevirtual #CP                 // Method org/ek9/lang/Stdout.println:(Lorg/ek9/lang/String;)V
       201: goto          221
       204: aload_2
       205: astore        27
       207: ldc           #CP                 // String No value
       209: invokestatic  #CP                 // Method org/ek9/lang/String._of:(Ljava/lang/String;)Lorg/ek9/lang/String;
       212: astore        28
       214: aload         27
       216: aload         28
       218: invokevirtual #CP                 // Method org/ek9/lang/Stdout.println:(Lorg/ek9/lang/String;)V
       221: aload_2
       222: astore        29
       224: ldc           #CP                 // String Done
       226: invokestatic  #CP                 // Method org/ek9/lang/String._of:(Ljava/lang/String;)Lorg/ek9/lang/String;
       229: astore        30
       231: aload         29
       233: aload         30
       235: invokevirtual #CP                 // Method org/ek9/lang/Stdout.println:(Lorg/ek9/lang/String;)V
       238: return

  static {};
    Code:
         0: return

  private void i_init();
    Code:
         0: return
}`
    IfWithGuard()
      -> shouldSet as Integer

      stdout <- Stdout()

      // Create Optional based on parameter
      optionalValue <- Optional() of String
      if shouldSet > 0
        optionalValue: Optional("TestValue")

      // Guard-only pattern: if value <- optionalValue
      // Tests if optionalValue is set (implicit ?check)
      if value <- optionalValue
        // value is the Optional itself when set
        actualValue <- value.get()
        stdout.println("Got value: " + actualValue)
      else
        stdout.println("No value")

      // Always print to verify program continues
      stdout.println("Done")

//EOF
