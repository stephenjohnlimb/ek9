#!ek9
<?-
  Bytecode test for while statement with guard and condition.
  Tests guard variable pattern: while value <- expr then condition
  Guard is evaluated once at entry, condition checked each iteration.
-?>
defines module bytecode.test.whileguard

  defines program

    @BYTECODE: CODE_GENERATION_AGGREGATES: TYPE: "bytecode.test.whileguard::SimpleWhileWithGuard": `public class bytecode.test.whileguard.SimpleWhileWithGuard {
  public bytecode.test.whileguard.SimpleWhileWithGuard();
    Code:
         0: aload_0
         1: invokespecial #CP                  // Method java/lang/Object."<init>":()V
         4: aload_0
         5: invokevirtual #CP                 // Method i_init:()V
         8: return

  public void _main(org.ek9.lang.Integer);
    Code:
         0: aconst_null
         1: astore_2
         2: new           #CP                 // class org/ek9/lang/Stdout
         5: dup
         6: invokespecial #CP                 // Method org/ek9/lang/Stdout."<init>":()V
         9: astore_3
        10: aload_3
        11: astore_2
        12: aconst_null
        13: astore        4
        15: iconst_0
        16: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
        19: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
        22: astore        5
        24: aload         5
        26: astore        4
        28: aconst_null
        29: astore        6
        31: new           #CP                 // class org/ek9/lang/Integer
        34: dup
        35: invokespecial #CP                 // Method org/ek9/lang/Integer."<init>":()V
        38: astore        7
        40: aload         7
        42: astore        6
        44: aload_1
        45: astore        8
        47: iconst_0
        48: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
        51: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
        54: astore        9
        56: aload         8
        58: aload         9
        60: invokevirtual #CP                 // Method org/ek9/lang/Integer._gt:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Boolean;
        63: astore        10
        65: aload         10
        67: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
        70: istore        11
        72: iload         11
        74: ifeq          98
        77: aload_1
        78: astore        12
        80: new           #CP                 // class org/ek9/lang/Integer
        83: dup
        84: aload         12
        86: invokespecial #CP                 // Method org/ek9/lang/Integer."<init>":(Lorg/ek9/lang/Integer;)V
        89: astore        13
        91: aload         13
        93: astore        6
        95: goto          98
        98: aconst_null
        99: astore        14
       101: aload         6
       103: astore        15
       105: aload         15
       107: astore        14
       109: aload         14
       111: ifnull        118
       114: iconst_0
       115: goto          119
       118: iconst_1
       119: istore        16
       121: iload         16
       123: ifeq          138
       126: invokestatic  #CP                 // Method org/ek9/lang/Boolean._ofFalse:()Lorg/ek9/lang/Boolean;
       129: astore        17
       131: aload         17
       133: astore        18
       135: goto          153
       138: aload         14
       140: astore        19
       142: aload         19
       144: invokevirtual #CP                 // Method org/ek9/lang/Integer._isSet:()Lorg/ek9/lang/Boolean;
       147: astore        20
       149: aload         20
       151: astore        18
       153: aload         18
       155: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
       158: istore        21
       160: iload         21
       162: ifeq          263
       165: aload         4
       167: astore        22
       169: aload         14
       171: astore        23
       173: aload         22
       175: aload         23
       177: invokevirtual #CP                 // Method org/ek9/lang/Integer._lt:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Boolean;
       180: astore        24
       182: aload         24
       184: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
       187: istore        25
       189: iload         25
       191: ifeq          260
       194: aload         4
       196: astore        26
       198: iconst_1
       199: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
       202: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
       205: astore        27
       207: aload         26
       209: aload         27
       211: invokevirtual #CP                 // Method org/ek9/lang/Integer._add:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Integer;
       214: astore        28
       216: aload         28
       218: astore        4
       220: aload_2
       221: astore        29
       223: ldc           #CP                 // String Iteration:
       225: invokestatic  #CP                 // Method org/ek9/lang/String._of:(Ljava/lang/String;)Lorg/ek9/lang/String;
       228: astore        30
       230: aload         4
       232: astore        31
       234: aload         31
       236: invokevirtual #CP                 // Method org/ek9/lang/Integer._string:()Lorg/ek9/lang/String;
       239: astore        32
       241: aload         30
       243: aload         32
       245: invokevirtual #CP                 // Method org/ek9/lang/String._add:(Lorg/ek9/lang/String;)Lorg/ek9/lang/String;
       248: astore        33
       250: aload         29
       252: aload         33
       254: invokevirtual #CP                 // Method org/ek9/lang/Stdout.println:(Lorg/ek9/lang/String;)V
       257: goto          165
       260: goto          263
       263: aload_2
       264: astore        34
       266: ldc           #CP                 // String Total:
       268: invokestatic  #CP                 // Method org/ek9/lang/String._of:(Ljava/lang/String;)Lorg/ek9/lang/String;
       271: astore        35
       273: aload         4
       275: astore        36
       277: aload         36
       279: invokevirtual #CP                 // Method org/ek9/lang/Integer._string:()Lorg/ek9/lang/String;
       282: astore        37
       284: aload         35
       286: aload         37
       288: invokevirtual #CP                 // Method org/ek9/lang/String._add:(Lorg/ek9/lang/String;)Lorg/ek9/lang/String;
       291: astore        38
       293: aload         34
       295: aload         38
       297: invokevirtual #CP                 // Method org/ek9/lang/Stdout.println:(Lorg/ek9/lang/String;)V
       300: aload_2
       301: astore        39
       303: ldc           #CP                 // String Done
       305: invokestatic  #CP                 // Method org/ek9/lang/String._of:(Ljava/lang/String;)Lorg/ek9/lang/String;
       308: astore        40
       310: aload         39
       312: aload         40
       314: invokevirtual #CP                 // Method org/ek9/lang/Stdout.println:(Lorg/ek9/lang/String;)V
       317: return

  static {};
    Code:
         0: return

  private void i_init();
    Code:
         0: return
}`

    SimpleWhileWithGuard()
      -> maxIterations as Integer

      stdout <- Stdout()
      count <- 0

      // Compute the limit inline (simulating function result)
      exprValue <- Integer()
      if maxIterations > 0
        exprValue: Integer(maxIterations)

      // While loop with guard - guard checked once, condition each iteration
      // Loops while count < limit (if limit is set/positive)
      while limit <- exprValue then count < limit
        count := count + 1
        stdout.println("Iteration: " + $count)

      stdout.println("Total: " + $count)
      stdout.println("Done")

//EOF
