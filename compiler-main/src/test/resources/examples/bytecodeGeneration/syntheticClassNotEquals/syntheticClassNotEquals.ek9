#!ek9
<?-
  Bytecode test for synthetic not-equals (<>) operator.

  This tests that the generated _neq bytecode:
  1. Calls this._eq(param) to get equality result
  2. If eq returns unset, returns unset
  3. If eq returns true (objects equal), returns false
  4. If eq returns false (objects not equal), returns true

  The test program verifies the operator works correctly at runtime.
-?>
defines module bytecode.syntheticClassNotEquals

  @BYTECODE: CODE_GENERATION_AGGREGATES: TYPE: "bytecode.syntheticClassNotEquals::SimplePoint": `public class bytecode.syntheticClassNotEquals.SimplePoint implements org.ek9.lang.Any

{
  private org.ek9.lang.Integer x;

  private org.ek9.lang.Integer y;

  public org.ek9.lang.Boolean _isSet();
    Code:
         0: aconst_null
         1: astore_1
         2: aload_0
         3: getfield      #CP                 // Field x:Lorg/ek9/lang/Integer;
         6: astore_2
         7: aload_2
         8: invokevirtual #CP                 // Method org/ek9/lang/Integer._isSet:()Lorg/ek9/lang/Boolean;
        11: astore_3
        12: aload_3
        13: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
        16: istore        4
        18: iload         4
        20: ifne          61
        23: aload_0
        24: getfield      #CP                 // Field y:Lorg/ek9/lang/Integer;
        27: astore        5
        29: aload         5
        31: invokevirtual #CP                 // Method org/ek9/lang/Integer._isSet:()Lorg/ek9/lang/Boolean;
        34: astore        6
        36: aload         6
        38: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
        41: istore        7
        43: iload         7
        45: ifne          61
        48: goto          51
        51: invokestatic  #CP                 // Method org/ek9/lang/Boolean._ofFalse:()Lorg/ek9/lang/Boolean;
        54: astore        8
        56: aload         8
        58: astore_1
        59: aload_1
        60: areturn
        61: invokestatic  #CP                 // Method org/ek9/lang/Boolean._ofTrue:()Lorg/ek9/lang/Boolean;
        64: astore        9
        66: aload         9
        68: astore_1
        69: aload_1
        70: areturn

  public org.ek9.lang.Bits _fieldSetStatus();
    Code:
         0: aconst_null
         1: astore_1
         2: ldc           #CP                 // String
         4: invokestatic  #CP                 // Method org/ek9/lang/String._of:(Ljava/lang/String;)Lorg/ek9/lang/String;
         7: astore_2
         8: new           #CP                 // class org/ek9/lang/Bits
        11: dup
        12: aload_2
        13: invokespecial #CP                 // Method org/ek9/lang/Bits."<init>":(Lorg/ek9/lang/String;)V
        16: astore_3
        17: aload_3
        18: astore_1
        19: aload_0
        20: getfield      #CP                 // Field x:Lorg/ek9/lang/Integer;
        23: astore        4
        25: aload         4
        27: invokevirtual #CP                 // Method org/ek9/lang/Integer._isSet:()Lorg/ek9/lang/Boolean;
        30: astore        5
        32: aload_1
        33: aload         5
        35: invokevirtual #CP                 // Method org/ek9/lang/Bits._addAss:(Lorg/ek9/lang/Boolean;)V
        38: aload_0
        39: getfield      #CP                 // Field y:Lorg/ek9/lang/Integer;
        42: astore        6
        44: aload         6
        46: invokevirtual #CP                 // Method org/ek9/lang/Integer._isSet:()Lorg/ek9/lang/Boolean;
        49: astore        7
        51: aload_1
        52: aload         7
        54: invokevirtual #CP                 // Method org/ek9/lang/Bits._addAss:(Lorg/ek9/lang/Boolean;)V
        57: aload_1
        58: areturn

  public org.ek9.lang.Boolean _neq(bytecode.syntheticClassNotEquals.SimplePoint);
    Code:
         0: aconst_null
         1: astore_2
         2: aload_0
         3: aload_1
         4: invokevirtual #CP                 // Method _eq:(Lbytecode/syntheticClassNotEquals/SimplePoint;)Lorg/ek9/lang/Boolean;
         7: astore_3
         8: aload_3
         9: invokevirtual #CP                 // Method org/ek9/lang/Boolean._isSet:()Lorg/ek9/lang/Boolean;
        12: astore        4
        14: aload         4
        16: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
        19: istore        5
        21: iload         5
        23: ifeq          40
        26: aload_3
        27: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
        30: istore        6
        32: iload         6
        34: ifne          54
        37: goto          64
        40: new           #CP                 // class org/ek9/lang/Boolean
        43: dup
        44: invokespecial #CP                 // Method org/ek9/lang/Boolean."<init>":()V
        47: astore        7
        49: aload         7
        51: astore_2
        52: aload_2
        53: areturn
        54: invokestatic  #CP                 // Method org/ek9/lang/Boolean._ofFalse:()Lorg/ek9/lang/Boolean;
        57: astore        8
        59: aload         8
        61: astore_2
        62: aload_2
        63: areturn
        64: invokestatic  #CP                 // Method org/ek9/lang/Boolean._ofTrue:()Lorg/ek9/lang/Boolean;
        67: astore        9
        69: aload         9
        71: astore_2
        72: aload_2
        73: areturn

  public org.ek9.lang.Boolean _eq(bytecode.syntheticClassNotEquals.SimplePoint);
    Code:
         0: aconst_null
         1: astore_2
         2: aload_0
         3: invokevirtual #CP                 // Method _isSet:()Lorg/ek9/lang/Boolean;
         6: astore_3
         7: aload_3
         8: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
        11: istore        4
        13: iload         4
        15: ifeq          195
        18: aload_1
        19: invokevirtual #CP                 // Method _isSet:()Lorg/ek9/lang/Boolean;
        22: astore        5
        24: aload         5
        26: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
        29: istore        6
        31: iload         6
        33: ifeq          195
        36: aload_0
        37: invokevirtual #CP                 // Method _fieldSetStatus:()Lorg/ek9/lang/Bits;
        40: astore        7
        42: aload_1
        43: invokevirtual #CP                 // Method _fieldSetStatus:()Lorg/ek9/lang/Bits;
        46: astore        8
        48: aload         7
        50: aload         8
        52: invokevirtual #CP                 // Method org/ek9/lang/Bits._eq:(Lorg/ek9/lang/Bits;)Lorg/ek9/lang/Boolean;
        55: astore        9
        57: aload         9
        59: invokevirtual #CP                 // Method org/ek9/lang/Boolean._isSet:()Lorg/ek9/lang/Boolean;
        62: astore        10
        64: aload         10
        66: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
        69: istore        11
        71: iload         11
        73: ifeq          195
        76: aload         9
        78: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
        81: istore        12
        83: iload         12
        85: ifeq          195
        88: aload_0
        89: getfield      #CP                 // Field x:Lorg/ek9/lang/Integer;
        92: astore        13
        94: aload_1
        95: getfield      #CP                 // Field x:Lorg/ek9/lang/Integer;
        98: astore        14
       100: aload         13
       102: aload         14
       104: invokevirtual #CP                 // Method org/ek9/lang/Integer._eq:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Boolean;
       107: astore        15
       109: aload         15
       111: invokevirtual #CP                 // Method org/ek9/lang/Boolean._isSet:()Lorg/ek9/lang/Boolean;
       114: astore        16
       116: aload         16
       118: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
       121: istore        17
       123: iload         17
       125: ifeq          195
       128: aload         15
       130: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
       133: istore        18
       135: iload         18
       137: ifeq          209
       140: aload_0
       141: getfield      #CP                 // Field y:Lorg/ek9/lang/Integer;
       144: astore        19
       146: aload_1
       147: getfield      #CP                 // Field y:Lorg/ek9/lang/Integer;
       150: astore        20
       152: aload         19
       154: aload         20
       156: invokevirtual #CP                 // Method org/ek9/lang/Integer._eq:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Boolean;
       159: astore        21
       161: aload         21
       163: invokevirtual #CP                 // Method org/ek9/lang/Boolean._isSet:()Lorg/ek9/lang/Boolean;
       166: astore        22
       168: aload         22
       170: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
       173: istore        23
       175: iload         23
       177: ifeq          195
       180: aload         21
       182: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
       185: istore        24
       187: iload         24
       189: ifeq          209
       192: goto          219
       195: new           #CP                 // class org/ek9/lang/Boolean
       198: dup
       199: invokespecial #CP                 // Method org/ek9/lang/Boolean."<init>":()V
       202: astore        25
       204: aload         25
       206: astore_2
       207: aload_2
       208: areturn
       209: invokestatic  #CP                 // Method org/ek9/lang/Boolean._ofFalse:()Lorg/ek9/lang/Boolean;
       212: astore        26
       214: aload         26
       216: astore_2
       217: aload_2
       218: areturn
       219: invokestatic  #CP                 // Method org/ek9/lang/Boolean._ofTrue:()Lorg/ek9/lang/Boolean;
       222: astore        27
       224: aload         27
       226: astore_2
       227: aload_2
       228: areturn

  public org.ek9.lang.Integer _cmp(bytecode.syntheticClassNotEquals.SimplePoint);
    Code:
         0: aconst_null
         1: astore_2
         2: aload_0
         3: invokevirtual #CP                 // Method _isSet:()Lorg/ek9/lang/Boolean;
         6: astore_3
         7: aload_3
         8: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
        11: istore        4
        13: iload         4
        15: ifeq          243
        18: aload_1
        19: invokevirtual #CP                 // Method _isSet:()Lorg/ek9/lang/Boolean;
        22: astore        5
        24: aload         5
        26: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
        29: istore        6
        31: iload         6
        33: ifeq          243
        36: aload_0
        37: invokevirtual #CP                 // Method _fieldSetStatus:()Lorg/ek9/lang/Bits;
        40: astore        7
        42: aload_1
        43: invokevirtual #CP                 // Method _fieldSetStatus:()Lorg/ek9/lang/Bits;
        46: astore        8
        48: aload         7
        50: aload         8
        52: invokevirtual #CP                 // Method org/ek9/lang/Bits._eq:(Lorg/ek9/lang/Bits;)Lorg/ek9/lang/Boolean;
        55: astore        9
        57: aload         9
        59: invokevirtual #CP                 // Method org/ek9/lang/Boolean._isSet:()Lorg/ek9/lang/Boolean;
        62: astore        10
        64: aload         10
        66: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
        69: istore        11
        71: iload         11
        73: ifeq          243
        76: aload         9
        78: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
        81: istore        12
        83: iload         12
        85: ifeq          243
        88: aload_0
        89: getfield      #CP                 // Field x:Lorg/ek9/lang/Integer;
        92: astore        13
        94: aload_1
        95: getfield      #CP                 // Field x:Lorg/ek9/lang/Integer;
        98: astore        14
       100: aload         13
       102: aload         14
       104: invokevirtual #CP                 // Method org/ek9/lang/Integer._cmp:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Integer;
       107: astore        15
       109: aload         15
       111: invokevirtual #CP                 // Method org/ek9/lang/Integer._isSet:()Lorg/ek9/lang/Boolean;
       114: astore        16
       116: aload         16
       118: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
       121: istore        17
       123: iload         17
       125: ifeq          243
       128: iconst_0
       129: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
       132: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
       135: astore        18
       137: aload         15
       139: aload         18
       141: invokevirtual #CP                 // Method org/ek9/lang/Integer._eq:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Boolean;
       144: astore        19
       146: aload         19
       148: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
       151: istore        20
       153: iload         20
       155: ifne          164
       158: aload         15
       160: astore_2
       161: goto          271
       164: aload_0
       165: getfield      #CP                 // Field y:Lorg/ek9/lang/Integer;
       168: astore        21
       170: aload_1
       171: getfield      #CP                 // Field y:Lorg/ek9/lang/Integer;
       174: astore        22
       176: aload         21
       178: aload         22
       180: invokevirtual #CP                 // Method org/ek9/lang/Integer._cmp:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Integer;
       183: astore        23
       185: aload         23
       187: invokevirtual #CP                 // Method org/ek9/lang/Integer._isSet:()Lorg/ek9/lang/Boolean;
       190: astore        24
       192: aload         24
       194: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
       197: istore        25
       199: iload         25
       201: ifeq          243
       204: iconst_0
       205: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
       208: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
       211: astore        26
       213: aload         23
       215: aload         26
       217: invokevirtual #CP                 // Method org/ek9/lang/Integer._eq:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Boolean;
       220: astore        27
       222: aload         27
       224: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
       227: istore        28
       229: iload         28
       231: ifne          240
       234: aload         23
       236: astore_2
       237: goto          271
       240: goto          257
       243: new           #CP                 // class org/ek9/lang/Integer
       246: dup
       247: invokespecial #CP                 // Method org/ek9/lang/Integer."<init>":()V
       250: astore        29
       252: aload         29
       254: astore_2
       255: aload_2
       256: areturn
       257: iconst_0
       258: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
       261: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
       264: astore        30
       266: aload         30
       268: astore_2
       269: aload_2
       270: areturn
       271: aload_2
       272: areturn

  public bytecode.syntheticClassNotEquals.SimplePoint();
    Code:
         0: aload_0
         1: invokespecial #CP                 // Method java/lang/Object."<init>":()V
         4: aload_0
         5: invokevirtual #CP                 // Method i_init:()V
         8: return

  public bytecode.syntheticClassNotEquals.SimplePoint(org.ek9.lang.Integer, org.ek9.lang.Integer);
    Code:
         0: aload_0
         1: invokespecial #CP                 // Method java/lang/Object."<init>":()V
         4: aload_0
         5: invokevirtual #CP                 // Method i_init:()V
         8: aload_0
         9: getfield      #CP                 // Field x:Lorg/ek9/lang/Integer;
        12: astore_3
        13: aload_1
        14: astore        4
        16: aload_3
        17: aload         4
        19: invokevirtual #CP                 // Method org/ek9/lang/Integer._copy:(Lorg/ek9/lang/Integer;)V
        22: aload_0
        23: getfield      #CP                 // Field y:Lorg/ek9/lang/Integer;
        26: astore        5
        28: aload_2
        29: astore        6
        31: aload         5
        33: aload         6
        35: invokevirtual #CP                 // Method org/ek9/lang/Integer._copy:(Lorg/ek9/lang/Integer;)V
        38: return

  static {};
    Code:
         0: return

  private void i_init();
    Code:
         0: aconst_null
         1: aload_0
         2: swap
         3: putfield      #CP                 // Field x:Lorg/ek9/lang/Integer;
         6: bipush        10
         8: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
        11: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
        14: astore_1
        15: aload_1
        16: aload_0
        17: swap
        18: putfield      #CP                 // Field x:Lorg/ek9/lang/Integer;
        21: aconst_null
        22: aload_0
        23: swap
        24: putfield      #CP                 // Field y:Lorg/ek9/lang/Integer;
        27: bipush        20
        29: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
        32: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
        35: astore_2
        36: aload_2
        37: aload_0
        38: swap
        39: putfield      #CP                 // Field y:Lorg/ek9/lang/Integer;
        42: return
}`

  defines class

    SimplePoint
      x <- 10
      y <- 20

      SimplePoint()
        ->
          xVal as Integer
          yVal as Integer
        this.x :=: xVal
        this.y :=: yVal

      default operator ?
      default operator <=>
      default operator ==
      default operator <>

  defines program

    TestSyntheticClassNotEquals()
      stdout <- Stdout()

      stdout.println("Test 0: isSet check")
      p1 <- SimplePoint(10, 20)
      p2 <- SimplePoint(10, 20)
      if p1?
        stdout.println("p1 is set")
      if p2?
        stdout.println("p2 is set")

      stdout.println("Test 1: Not equals on equal points")
      neq1 <- p1 <> p2
      stdout.println(neq1)

      stdout.println("Test 2: Not equals on different points")
      p3 <- SimplePoint(99, 20)
      neq2 <- p1 <> p3
      stdout.println(neq2)

      stdout.println("Test 3: Consistency with equals")
      eq1 <- p1 == p2
      neq3 <- p1 <> p2
      stdout.println(eq1)
      stdout.println(neq3)

      stdout.println("All tests passed")

//EOF
