#!ek9
<?-
  Bytecode test for if/else-if with multiple guards.
  Tests guard variable pattern in if/else-if chain.
  Each if/else-if block can have its own guard variable.
-?>
defines module bytecode.test

  defines program

    @BYTECODE: CODE_GENERATION_AGGREGATES: TYPE: "bytecode.test::IfElseIfWithGuards": `public class bytecode.test.IfElseIfWithGuards {
  public bytecode.test.IfElseIfWithGuards();
    Code:
         0: aload_0
         1: invokespecial #CP                  // Method java/lang/Object."<init>":()V
         4: aload_0
         5: invokevirtual #CP                 // Method i_init:()V
         8: return

  public void _main(org.ek9.lang.Integer);
    Code:
         0: aconst_null
         1: astore_2
         2: new           #CP                 // class org/ek9/lang/Stdout
         5: dup
         6: invokespecial #CP                 // Method org/ek9/lang/Stdout."<init>":()V
         9: astore_3
        10: aload_3
        11: astore_2
        12: aconst_null
        13: astore        4
        15: new           #CP                 // class org/ek9/lang/_Optional_C011A3DC69C147B21BB3B4318CD6E648E5B36284DE9A0658F8CDDD33D8C1B5BC
        18: dup
        19: invokespecial #CP                 // Method org/ek9/lang/_Optional_C011A3DC69C147B21BB3B4318CD6E648E5B36284DE9A0658F8CDDD33D8C1B5BC."<init>":()V
        22: astore        5
        24: aload         5
        26: astore        4
        28: aconst_null
        29: astore        6
        31: new           #CP                 // class org/ek9/lang/_Optional_C011A3DC69C147B21BB3B4318CD6E648E5B36284DE9A0658F8CDDD33D8C1B5BC
        34: dup
        35: invokespecial #CP                 // Method org/ek9/lang/_Optional_C011A3DC69C147B21BB3B4318CD6E648E5B36284DE9A0658F8CDDD33D8C1B5BC."<init>":()V
        38: astore        7
        40: aload         7
        42: astore        6
        44: aload_1
        45: astore        8
        47: iconst_1
        48: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
        51: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
        54: astore        9
        56: aload         8
        58: aload         9
        60: invokevirtual #CP                 // Method org/ek9/lang/Integer._eq:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Boolean;
        63: astore        10
        65: aload         10
        67: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
        70: istore        11
        72: iload         11
        74: ifeq          102
        77: ldc           #CP                 // String FirstValue
        79: invokestatic  #CP                 // Method org/ek9/lang/String._of:(Ljava/lang/String;)Lorg/ek9/lang/String;
        82: astore        12
        84: new           #CP                 // class org/ek9/lang/_Optional_C011A3DC69C147B21BB3B4318CD6E648E5B36284DE9A0658F8CDDD33D8C1B5BC
        87: dup
        88: aload         12
        90: invokespecial #CP                 // Method org/ek9/lang/_Optional_C011A3DC69C147B21BB3B4318CD6E648E5B36284DE9A0658F8CDDD33D8C1B5BC."<init>":(Lorg/ek9/lang/String;)V
        93: astore        13
        95: aload         13
        97: astore        4
        99: goto          160
       102: aload_1
       103: astore        14
       105: iconst_2
       106: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
       109: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
       112: astore        15
       114: aload         14
       116: aload         15
       118: invokevirtual #CP                 // Method org/ek9/lang/Integer._eq:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Boolean;
       121: astore        16
       123: aload         16
       125: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
       128: istore        17
       130: iload         17
       132: ifeq          160
       135: ldc           #CP                 // String SecondValue
       137: invokestatic  #CP                 // Method org/ek9/lang/String._of:(Ljava/lang/String;)Lorg/ek9/lang/String;
       140: astore        18
       142: new           #CP                 // class org/ek9/lang/_Optional_C011A3DC69C147B21BB3B4318CD6E648E5B36284DE9A0658F8CDDD33D8C1B5BC
       145: dup
       146: aload         18
       148: invokespecial #CP                 // Method org/ek9/lang/_Optional_C011A3DC69C147B21BB3B4318CD6E648E5B36284DE9A0658F8CDDD33D8C1B5BC."<init>":(Lorg/ek9/lang/String;)V
       151: astore        19
       153: aload         19
       155: astore        6
       157: goto          160
       160: aconst_null
       161: astore        20
       163: aload         4
       165: astore        21
       167: aload         21
       169: astore        20
       171: aconst_null
       172: astore        22
       174: aload         6
       176: astore        23
       178: aload         23
       180: astore        22
       182: aload         20
       184: ifnull        191
       187: iconst_0
       188: goto          192
       191: iconst_1
       192: istore        24
       194: iload         24
       196: ifeq          211
       199: invokestatic  #CP                 // Method org/ek9/lang/Boolean._ofFalse:()Lorg/ek9/lang/Boolean;
       202: astore        25
       204: aload         25
       206: astore        26
       208: goto          226
       211: aload         20
       213: astore        27
       215: aload         27
       217: invokevirtual #CP                 // Method org/ek9/lang/_Optional_C011A3DC69C147B21BB3B4318CD6E648E5B36284DE9A0658F8CDDD33D8C1B5BC._isSet:()Lorg/ek9/lang/Boolean;
       220: astore        28
       222: aload         28
       224: astore        26
       226: aload         26
       228: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
       231: istore        29
       233: iload         29
       235: ifeq          278
       238: aload_2
       239: astore        30
       241: ldc           #CP                 // String Got first:
       243: invokestatic  #CP                 // Method org/ek9/lang/String._of:(Ljava/lang/String;)Lorg/ek9/lang/String;
       246: astore        31
       248: aload         20
       250: astore        32
       252: aload         32
       254: invokevirtual #CP                 // Method org/ek9/lang/_Optional_C011A3DC69C147B21BB3B4318CD6E648E5B36284DE9A0658F8CDDD33D8C1B5BC.get:()Lorg/ek9/lang/String;
       257: astore        33
       259: aload         31
       261: aload         33
       263: invokevirtual #CP                 // Method org/ek9/lang/String._add:(Lorg/ek9/lang/String;)Lorg/ek9/lang/String;
       266: astore        34
       268: aload         30
       270: aload         34
       272: invokevirtual #CP                 // Method org/ek9/lang/Stdout.println:(Lorg/ek9/lang/String;)V
       275: goto          391
       278: aload         22
       280: ifnull        287
       283: iconst_0
       284: goto          288
       287: iconst_1
       288: istore        35
       290: iload         35
       292: ifeq          307
       295: invokestatic  #CP                 // Method org/ek9/lang/Boolean._ofFalse:()Lorg/ek9/lang/Boolean;
       298: astore        36
       300: aload         36
       302: astore        37
       304: goto          322
       307: aload         22
       309: astore        38
       311: aload         38
       313: invokevirtual #CP                 // Method org/ek9/lang/_Optional_C011A3DC69C147B21BB3B4318CD6E648E5B36284DE9A0658F8CDDD33D8C1B5BC._isSet:()Lorg/ek9/lang/Boolean;
       316: astore        39
       318: aload         39
       320: astore        37
       322: aload         37
       324: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
       327: istore        40
       329: iload         40
       331: ifeq          374
       334: aload_2
       335: astore        41
       337: ldc           #CP                 // String Got second:
       339: invokestatic  #CP                 // Method org/ek9/lang/String._of:(Ljava/lang/String;)Lorg/ek9/lang/String;
       342: astore        42
       344: aload         22
       346: astore        43
       348: aload         43
       350: invokevirtual #CP                 // Method org/ek9/lang/_Optional_C011A3DC69C147B21BB3B4318CD6E648E5B36284DE9A0658F8CDDD33D8C1B5BC.get:()Lorg/ek9/lang/String;
       353: astore        44
       355: aload         42
       357: aload         44
       359: invokevirtual #CP                 // Method org/ek9/lang/String._add:(Lorg/ek9/lang/String;)Lorg/ek9/lang/String;
       362: astore        45
       364: aload         41
       366: aload         45
       368: invokevirtual #CP                 // Method org/ek9/lang/Stdout.println:(Lorg/ek9/lang/String;)V
       371: goto          391
       374: aload_2
       375: astore        46
       377: ldc           #CP                 // String Got neither
       379: invokestatic  #CP                 // Method org/ek9/lang/String._of:(Ljava/lang/String;)Lorg/ek9/lang/String;
       382: astore        47
       384: aload         46
       386: aload         47
       388: invokevirtual #CP                 // Method org/ek9/lang/Stdout.println:(Lorg/ek9/lang/String;)V
       391: aload_2
       392: astore        48
       394: ldc           #CP                 // String Done
       396: invokestatic  #CP                 // Method org/ek9/lang/String._of:(Ljava/lang/String;)Lorg/ek9/lang/String;
       399: astore        49
       401: aload         48
       403: aload         49
       405: invokevirtual #CP                 // Method org/ek9/lang/Stdout.println:(Lorg/ek9/lang/String;)V
       408: return

  static {};
    Code:
         0: return

  private void i_init();
    Code:
         0: return
}`
    IfElseIfWithGuards()
      -> testCase as Integer

      stdout <- Stdout()

      // Create two Optional values based on testCase
      // testCase 0: both unset (no guards succeed)
      // testCase 1: first set, second unset (first guard succeeds)
      // testCase 2: first unset, second set (second guard succeeds)
      firstValue <- Optional() of String
      secondValue <- Optional() of String

      if testCase == 1
        firstValue: Optional("FirstValue")
      else if testCase == 2
        secondValue: Optional("SecondValue")

      // Multiple guards in if/else-if chain
      // Each block tests its own Optional
      if value1 <- firstValue
        stdout.println("Got first: " + value1.get())
      else if value2 <- secondValue
        stdout.println("Got second: " + value2.get())
      else
        stdout.println("Got neither")

      stdout.println("Done")

//EOF
