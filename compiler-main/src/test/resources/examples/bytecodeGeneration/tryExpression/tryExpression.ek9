#!ek9
<?-
  Bytecode test for try expression form.
  Expression form: result <- try <- rtn <- initialValue ... catch
  The try returns a value through the rtn variable.

  This program computes a value in try block or returns default on exception.
  For input=10: result = 10 * 2 = 20
  For input=0: result = 0 (if division by zero could occur, catch would return -1)
-?>
defines module bytecode.test.tryexpr

  defines program

    @BYTECODE: CODE_GENERATION_AGGREGATES: TYPE: "bytecode.test.tryexpr::TryExpression": `public class bytecode.test.tryexpr.TryExpression {
  static {};
    Code:
         0: return

  private void i_init();
    Code:
         0: return

  public bytecode.test.tryexpr.TryExpression();
    Code:
         0: aload_0
         1: invokespecial #CP                 // Method java/lang/Object."<init>":()V
         4: aload_0
         5: invokevirtual #CP                 // Method i_init:()V
         8: return

  public void _main(org.ek9.lang.Integer);
    Code:
         0: aconst_null
         1: astore_2
         2: new           #CP                 // class org/ek9/lang/Stdout
         5: dup
         6: invokespecial #CP                 // Method org/ek9/lang/Stdout."<init>":()V
         9: astore_3
        10: aload_3
        11: astore_2
        12: aconst_null
        13: astore        4
        15: aconst_null
        16: astore        5
        18: iconst_m1
        19: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
        22: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
        25: astore        6
        27: aload         6
        29: astore        5
        31: aload_1
        32: astore        7
        34: iconst_2
        35: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
        38: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
        41: astore        8
        43: aload         7
        45: aload         8
        47: invokevirtual #CP                 // Method org/ek9/lang/Integer._mul:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Integer;
        50: astore        9
        52: aload         9
        54: astore        5
        56: goto          77
        59: astore        10
        61: iconst_0
        62: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
        65: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
        68: astore        11
        70: aload         11
        72: astore        5
        74: goto          77
        77: aload         5
        79: astore        12
        81: aload         12
        83: astore        4
        85: aload_2
        86: astore        13
        88: aload         4
        90: astore        14
        92: aload         13
        94: aload         14
        96: invokeinterface #CP,  2           // InterfaceMethod org/ek9/lang/StringOutput.println:(Lorg/ek9/lang/Any;)V
       101: aload_2
       102: astore        15
       104: ldc           #CP                 // String Done
       106: invokestatic  #CP                 // Method org/ek9/lang/String._of:(Ljava/lang/String;)Lorg/ek9/lang/String;
       109: astore        16
       111: aload         15
       113: aload         16
       115: invokevirtual #CP                 // Method org/ek9/lang/Stdout.println:(Lorg/ek9/lang/String;)V
       118: return
      Exception table:
         from    to  target type
            31    56    59   Class org/ek9/lang/Exception
}
`

    TryExpression()
      -> input as Integer

      stdout <- Stdout()

      // Try expression: computes value or returns default on exception
      result <- try
        <- rtn <- -1
        rtn: input * 2
      catch
        -> ex as Exception
        rtn: 0

      // Print the result
      stdout.println(result)

      // Always print to verify program continues
      stdout.println("Done")

//EOF
