#!ek9
defines module bytecode.test

  defines program

    @BYTECODE: CODE_GENERATION_AGGREGATES: TYPE: "bytecode.test::ElvisCoalescingOperator": `public class bytecode.test.ElvisCoalescingOperator {
  public bytecode.test.ElvisCoalescingOperator();
    Code:
         0: aload_0
         1: invokespecial #CP                  // Method java/lang/Object."<init>":()V
         4: aload_0
         5: invokevirtual #CP                 // Method i_init:()V
         8: return

  public void _main();
    Code:
         0: aconst_null
         1: astore_1
         2: new           #CP                 // class org/ek9/lang/Stdout
         5: dup
         6: invokespecial #CP                 // Method org/ek9/lang/Stdout."<init>":()V
         9: astore_2
        10: aload_2
        11: astore_1
        12: aconst_null
        13: astore_3
        14: iconst_5
        15: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
        18: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
        21: astore        4
        23: aload         4
        25: astore_3
        26: aconst_null
        27: astore        5
        29: bipush        10
        31: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
        34: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
        37: astore        6
        39: aload         6
        41: astore        5
        43: aconst_null
        44: astore        7
        46: aload_3
        47: astore        8
        49: aload         8
        51: ifnull        58
        54: iconst_0
        55: goto          59
        58: iconst_1
        59: istore        9
        61: iload         9
        63: ifeq          77
        66: aload         5
        68: astore        10
        70: aload         10
        72: astore        11
        74: goto          111
        77: aload         8
        79: invokevirtual #CP                 // Method org/ek9/lang/Integer._isSet:()Lorg/ek9/lang/Boolean;
        82: astore        12
        84: aload         12
        86: invokevirtual #CP                 // Method org/ek9/lang/Boolean._false:()Z
        89: istore        13
        91: iload         13
        93: ifeq          107
        96: aload         5
        98: astore        10
       100: aload         10
       102: astore        11
       104: goto          111
       107: aload         8
       109: astore        11
       111: aload         11
       113: astore        7
       115: aload_1
       116: astore        14
       118: ldc           #CP                 // String Result1:
       120: invokestatic  #CP                 // Method org/ek9/lang/String._of:(Ljava/lang/String;)Lorg/ek9/lang/String;
       123: astore        15
       125: aload         7
       127: astore        16
       129: aload         16
       131: invokevirtual #CP                 // Method org/ek9/lang/Integer._string:()Lorg/ek9/lang/String;
       134: astore        17
       136: aload         15
       138: aload         17
       140: invokevirtual #CP                 // Method org/ek9/lang/String._add:(Lorg/ek9/lang/String;)Lorg/ek9/lang/String;
       143: astore        18
       145: aload         14
       147: aload         18
       149: invokevirtual #CP                 // Method org/ek9/lang/Stdout.println:(Lorg/ek9/lang/String;)V
       152: aload         7
       154: astore        19
       156: iconst_5
       157: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
       160: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
       163: astore        20
       165: aload         19
       167: aload         20
       169: invokevirtual #CP                 // Method org/ek9/lang/Integer._eq:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Boolean;
       172: astore        21
       174: aload         21
       176: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
       179: istore        22
       181: iload         22
       183: ifne          196
       186: new           #CP                 // class java/lang/AssertionError
       189: dup
       190: ldc           #CP                 // String Assertion failed
       192: invokespecial #CP                 // Method java/lang/AssertionError."<init>":(Ljava/lang/Object;)V
       195: athrow
       196: aconst_null
       197: astore        23
       199: new           #CP                 // class org/ek9/lang/Integer
       202: dup
       203: invokespecial #CP                 // Method org/ek9/lang/Integer."<init>":()V
       206: astore        24
       208: aload         24
       210: astore        23
       212: aconst_null
       213: astore        25
       215: aload         23
       217: astore        26
       219: aload         26
       221: ifnull        228
       224: iconst_0
       225: goto          229
       228: iconst_1
       229: istore        27
       231: iload         27
       233: ifeq          253
       236: bipush        42
       238: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
       241: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
       244: astore        28
       246: aload         28
       248: astore        29
       250: goto          293
       253: aload         26
       255: invokevirtual #CP                 // Method org/ek9/lang/Integer._isSet:()Lorg/ek9/lang/Boolean;
       258: astore        30
       260: aload         30
       262: invokevirtual #CP                 // Method org/ek9/lang/Boolean._false:()Z
       265: istore        31
       267: iload         31
       269: ifeq          289
       272: bipush        42
       274: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
       277: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
       280: astore        28
       282: aload         28
       284: astore        29
       286: goto          293
       289: aload         26
       291: astore        29
       293: aload         29
       295: astore        25
       297: aload_1
       298: astore        32
       300: ldc           #CP                 // String Result2:
       302: invokestatic  #CP                 // Method org/ek9/lang/String._of:(Ljava/lang/String;)Lorg/ek9/lang/String;
       305: astore        33
       307: aload         25
       309: astore        34
       311: aload         34
       313: invokevirtual #CP                 // Method org/ek9/lang/Integer._string:()Lorg/ek9/lang/String;
       316: astore        35
       318: aload         33
       320: aload         35
       322: invokevirtual #CP                 // Method org/ek9/lang/String._add:(Lorg/ek9/lang/String;)Lorg/ek9/lang/String;
       325: astore        36
       327: aload         32
       329: aload         36
       331: invokevirtual #CP                 // Method org/ek9/lang/Stdout.println:(Lorg/ek9/lang/String;)V
       334: aload         25
       336: astore        37
       338: bipush        42
       340: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
       343: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
       346: astore        38
       348: aload         37
       350: aload         38
       352: invokevirtual #CP                 // Method org/ek9/lang/Integer._eq:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Boolean;
       355: astore        39
       357: aload         39
       359: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
       362: istore        40
       364: iload         40
       366: ifne          379
       369: new           #CP                 // class java/lang/AssertionError
       372: dup
       373: ldc           #CP                 // String Assertion failed
       375: invokespecial #CP                 // Method java/lang/AssertionError."<init>":(Ljava/lang/Object;)V
       378: athrow
       379: return

  static {};
    Code:
         0: return

  private void i_init();
    Code:
         0: return
}`

    ElvisCoalescingOperator()
      stdout <- Stdout()

      // Test 1: Set value (should return LHS)
      x <- 5
      y <- 10
      result1 <- x ?: y
      stdout.println("Result1: " + $result1)
      assert result1 == 5

      // Test 2: Unset value (should return RHS)
      unsetValue <- Integer()
      result2 <- unsetValue ?: 42
      stdout.println("Result2: " + $result2)
      assert result2 == 42

//EOF
