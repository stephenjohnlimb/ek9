#!ek9
defines module bytecode.test

  defines program

    @BYTECODE: CODE_GENERATION_AGGREGATES: TYPE: "bytecode.test::NullCoalescingOperator": `public class bytecode.test.NullCoalescingOperator {
  static {};
    Code:
         0: return

  private void i_init();
    Code:
         0: return

  public bytecode.test.NullCoalescingOperator();
    Code:
         0: aload_0
         1: invokespecial #CP                 // Method java/lang/Object."<init>":()V
         4: aload_0
         5: invokevirtual #CP                 // Method i_init:()V
         8: return

  public void _main();
    Code:
         0: aconst_null
         1: astore_1
         2: new           #CP                 // class org/ek9/lang/Stdout
         5: dup
         6: invokespecial #CP                 // Method org/ek9/lang/Stdout."<init>":()V
         9: astore_2
        10: aload_2
        11: astore_1
        12: aconst_null
        13: astore_3
        14: iconst_5
        15: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
        18: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
        21: astore        4
        23: aload         4
        25: astore_3
        26: aconst_null
        27: astore        5
        29: bipush        10
        31: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
        34: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
        37: astore        6
        39: aload         6
        41: astore        5
        43: aconst_null
        44: astore        7
        46: aload_3
        47: astore        8
        49: aload         8
        51: ifnull        58
        54: iconst_0
        55: goto          59
        58: iconst_1
        59: istore        9
        61: iload         9
        63: ifeq          77
        66: aload         5
        68: astore        10
        70: aload         10
        72: astore        11
        74: goto          81
        77: aload         8
        79: astore        11
        81: aload         11
        83: astore        7
        85: aload_1
        86: astore        12
        88: ldc           #CP                 // String Result1:
        90: invokestatic  #CP                 // Method org/ek9/lang/String._of:(Ljava/lang/String;)Lorg/ek9/lang/String;
        93: astore        13
        95: aload         7
        97: astore        14
        99: aload         14
       101: invokevirtual #CP                 // Method org/ek9/lang/Integer._string:()Lorg/ek9/lang/String;
       104: astore        15
       106: aload         13
       108: aload         15
       110: invokevirtual #CP                 // Method org/ek9/lang/String._add:(Lorg/ek9/lang/String;)Lorg/ek9/lang/String;
       113: astore        16
       115: aload         12
       117: aload         16
       119: invokevirtual #CP                 // Method org/ek9/lang/Stdout.println:(Lorg/ek9/lang/String;)V
       122: aload         7
       124: astore        17
       126: iconst_5
       127: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
       130: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
       133: astore        18
       135: aload         17
       137: aload         18
       139: invokevirtual #CP                 // Method org/ek9/lang/Integer._eq:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Boolean;
       142: astore        19
       144: aload         19
       146: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
       149: istore        20
       151: iload         20
       153: ifne          166
       156: new           #CP                 // class java/lang/AssertionError
       159: dup
       160: ldc           #CP                 // String Assertion failed
       162: invokespecial #CP                 // Method java/lang/AssertionError."<init>":(Ljava/lang/Object;)V
       165: athrow
       166: aconst_null
       167: astore        21
       169: bipush        42
       171: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
       174: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
       177: astore        22
       179: aload         22
       181: astore        21
       183: aconst_null
       184: astore        23
       186: bipush        100
       188: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
       191: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
       194: astore        24
       196: aload         24
       198: astore        23
       200: aconst_null
       201: astore        25
       203: aload         21
       205: astore        26
       207: aload         26
       209: ifnull        216
       212: iconst_0
       213: goto          217
       216: iconst_1
       217: istore        27
       219: iload         27
       221: ifeq          235
       224: aload         23
       226: astore        28
       228: aload         28
       230: astore        29
       232: goto          239
       235: aload         26
       237: astore        29
       239: aload         29
       241: astore        25
       243: aload_1
       244: astore        30
       246: ldc           #CP                 // String Result2:
       248: invokestatic  #CP                 // Method org/ek9/lang/String._of:(Ljava/lang/String;)Lorg/ek9/lang/String;
       251: astore        31
       253: aload         25
       255: astore        32
       257: aload         32
       259: invokevirtual #CP                 // Method org/ek9/lang/Integer._string:()Lorg/ek9/lang/String;
       262: astore        33
       264: aload         31
       266: aload         33
       268: invokevirtual #CP                 // Method org/ek9/lang/String._add:(Lorg/ek9/lang/String;)Lorg/ek9/lang/String;
       271: astore        34
       273: aload         30
       275: aload         34
       277: invokevirtual #CP                 // Method org/ek9/lang/Stdout.println:(Lorg/ek9/lang/String;)V
       280: aload         25
       282: astore        35
       284: bipush        42
       286: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
       289: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
       292: astore        36
       294: aload         35
       296: aload         36
       298: invokevirtual #CP                 // Method org/ek9/lang/Integer._eq:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Boolean;
       301: astore        37
       303: aload         37
       305: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
       308: istore        38
       310: iload         38
       312: ifne          325
       315: new           #CP                 // class java/lang/AssertionError
       318: dup
       319: ldc           #CP                 // String Assertion failed
       321: invokespecial #CP                 // Method java/lang/AssertionError."<init>":(Ljava/lang/Object;)V
       324: athrow
       325: return
}`

    NullCoalescingOperator()
      stdout <- Stdout()

      // Test 1: Non-null value (should return LHS)
      x <- 5
      y <- 10
      result1 <- x ?? y
      stdout.println("Result1: " + $result1)
      assert result1 == 5

      // Test 2: Another non-null case
      a <- 42
      b <- 100
      result2 <- a ?? b
      stdout.println("Result2: " + $result2)
      assert result2 == 42

//EOF
