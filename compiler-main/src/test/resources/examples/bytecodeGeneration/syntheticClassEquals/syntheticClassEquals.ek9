#!ek9
<?-
  Bytecode test for synthetic operator generation.
  Tests default operator <=> on a simple class with ONE field.
-?>
defines module bytecode.syntheticClassEquals

  defines class

    @BYTECODE: CODE_GENERATION_AGGREGATES: TYPE: "bytecode.syntheticClassEquals::SimplePoint": `public class bytecode.syntheticClassEquals.SimplePoint implements org.ek9.lang.Any

{
  private org.ek9.lang.Integer x;

  public org.ek9.lang.Boolean _isSet();
    Code:
         0: aconst_null
         1: astore_1
         2: aload_0
         3: getfield      #CP                 // Field x:Lorg/ek9/lang/Integer;
         6: astore_2
         7: aload_2
         8: invokevirtual #CP                 // Method org/ek9/lang/Integer._isSet:()Lorg/ek9/lang/Boolean;
        11: astore_3
        12: aload_3
        13: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
        16: istore        4
        18: iload         4
        20: ifeq          26
        23: goto          36
        26: invokestatic  #CP                 // Method org/ek9/lang/Boolean._ofFalse:()Lorg/ek9/lang/Boolean;
        29: astore        5
        31: aload         5
        33: astore_1
        34: aload_1
        35: areturn
        36: invokestatic  #CP                 // Method org/ek9/lang/Boolean._ofTrue:()Lorg/ek9/lang/Boolean;
        39: astore        6
        41: aload         6
        43: astore_1
        44: aload_1
        45: areturn

  public org.ek9.lang.Integer _cmp(bytecode.syntheticClassEquals.SimplePoint);
    Code:
         0: aconst_null
         1: astore_2
         2: aload_0
         3: invokevirtual #CP                 // Method _isSet:()Lorg/ek9/lang/Boolean;
         6: astore_3
         7: aload_3
         8: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
        11: istore        4
        13: iload         4
        15: ifeq          167
        18: aload_1
        19: invokevirtual #CP                 // Method _isSet:()Lorg/ek9/lang/Boolean;
        22: astore        5
        24: aload         5
        26: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
        29: istore        6
        31: iload         6
        33: ifeq          167
        36: aload_0
        37: invokevirtual #CP                 // Method _fieldSetStatus:()Lorg/ek9/lang/Integer;
        40: astore        7
        42: aload_1
        43: invokevirtual #CP                 // Method _fieldSetStatus:()Lorg/ek9/lang/Integer;
        46: astore        8
        48: aload         7
        50: aload         8
        52: invokevirtual #CP                 // Method org/ek9/lang/Integer._eq:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Boolean;
        55: astore        9
        57: aload         9
        59: invokevirtual #CP                 // Method org/ek9/lang/Boolean._isSet:()Lorg/ek9/lang/Boolean;
        62: astore        10
        64: aload         10
        66: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
        69: istore        11
        71: iload         11
        73: ifeq          167
        76: aload         9
        78: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
        81: istore        12
        83: iload         12
        85: ifeq          167
        88: aload_0
        89: getfield      #CP                 // Field x:Lorg/ek9/lang/Integer;
        92: astore        13
        94: aload_1
        95: getfield      #CP                 // Field x:Lorg/ek9/lang/Integer;
        98: astore        14
       100: aload         13
       102: aload         14
       104: invokevirtual #CP                 // Method org/ek9/lang/Integer._cmp:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Integer;
       107: astore        15
       109: aload         15
       111: invokevirtual #CP                 // Method org/ek9/lang/Integer._isSet:()Lorg/ek9/lang/Boolean;
       114: astore        16
       116: aload         16
       118: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
       121: istore        17
       123: iload         17
       125: ifeq          167
       128: iconst_0
       129: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
       132: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
       135: astore        18
       137: aload         15
       139: aload         18
       141: invokevirtual #CP                 // Method org/ek9/lang/Integer._eq:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Boolean;
       144: astore        19
       146: aload         19
       148: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
       151: istore        20
       153: iload         20
       155: ifne          164
       158: aload         15
       160: astore_2
       161: goto          195
       164: goto          181
       167: new           #CP                 // class org/ek9/lang/Integer
       170: dup
       171: invokespecial #CP                 // Method org/ek9/lang/Integer."<init>":()V
       174: astore        21
       176: aload         21
       178: astore_2
       179: aload_2
       180: areturn
       181: iconst_0
       182: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
       185: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
       188: astore        22
       190: aload         22
       192: astore_2
       193: aload_2
       194: areturn
       195: aload_2
       196: areturn

  public org.ek9.lang.Integer _fieldSetStatus();
    Code:
         0: aconst_null
         1: astore_1
         2: iconst_0
         3: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
         6: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
         9: astore_2
        10: aload_2
        11: astore_1
        12: aload_0
        13: getfield      #CP                 // Field x:Lorg/ek9/lang/Integer;
        16: astore_3
        17: aload_3
        18: invokevirtual #CP                 // Method org/ek9/lang/Integer._isSet:()Lorg/ek9/lang/Boolean;
        21: astore        4
        23: aload         4
        25: invokevirtual #CP                 // Method org/ek9/lang/Boolean._true:()Z
        28: istore        5
        30: iload         5
        32: ifeq          55
        35: iconst_1
        36: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
        39: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
        42: astore        6
        44: aload_1
        45: aload         6
        47: invokevirtual #CP                 // Method org/ek9/lang/Integer._or:(Lorg/ek9/lang/Integer;)Lorg/ek9/lang/Integer;
        50: astore        7
        52: aload         7
        54: astore_1
        55: aload_1
        56: areturn

  public bytecode.syntheticClassEquals.SimplePoint();
    Code:
         0: aload_0
         1: invokespecial #CP                 // Method java/lang/Object."<init>":()V
         4: aload_0
         5: invokevirtual #CP                 // Method i_init:()V
         8: aload_0
         9: getfield      #CP                 // Field x:Lorg/ek9/lang/Integer;
        12: astore_1
        13: iconst_5
        14: invokestatic  #CP                 // Method java/lang/Integer.toString:(I)Ljava/lang/String;
        17: invokestatic  #CP                 // Method org/ek9/lang/Integer._of:(Ljava/lang/String;)Lorg/ek9/lang/Integer;
        20: astore_2
        21: aload_1
        22: aload_2
        23: invokevirtual #CP                 // Method org/ek9/lang/Integer._copy:(Lorg/ek9/lang/Integer;)V
        26: return

  static {};
    Code:
         0: return

  private void i_init();
    Code:
         0: aconst_null
         1: aload_0
         2: swap
         3: putfield      #CP                 // Field x:Lorg/ek9/lang/Integer;
         6: new           #CP                 // class org/ek9/lang/Integer
         9: dup
        10: invokespecial #CP                 // Method org/ek9/lang/Integer."<init>":()V
        13: astore_1
        14: aload_1
        15: aload_0
        16: swap
        17: putfield      #CP                 // Field x:Lorg/ek9/lang/Integer;
        20: return
}`

    SimplePoint
      x <- Integer()

      SimplePoint()
        this.x :=: 5

      //Needed for _isSet() to return true when object is set
      default operator ?

      //This is the synthetic operator that causes the Frame.merge error
      default operator <=>

  defines program

    TestSyntheticClassEquals()
      stdout <- Stdout()

      stdout.println("Test 1: Compare equal points")
      p1 <- SimplePoint()
      p2 <- SimplePoint()
      cmp1 <- p1 <=> p2
      stdout.println(cmp1)

      stdout.println("All tests passed")

//EOF
