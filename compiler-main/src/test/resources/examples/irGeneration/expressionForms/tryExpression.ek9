#!ek9
<?-
  Test IR generation for try expression form.
  Expression form: result <- try <- rtn <- initialValue ... catch -> ex ... rtn: value
  The try returns a value through the rtn variable (accumulator pattern).
-?>
defines module expressionForms.tryExpr

  defines function

    <?-
      Try expression that computes a value or returns default on exception.
      Uses try block to compute, catch to handle exceptions.
      Returns the computed or default value.
    -?>
    @IR: IR_GENERATION: FUNCTION: "expressionForms.tryExpr::tryExpression": `
ConstructDfn: expressionForms.tryExpr::tryExpression(org.ek9.lang::Integer)->org.ek9.lang::Integer
OperationDfn: expressionForms.tryExpr::tryExpression.c_init()->org.ek9.lang::Void
BasicBlock: _entry_1
RETURN
OperationDfn: expressionForms.tryExpr::tryExpression.i_init()->org.ek9.lang::Void
BasicBlock: _entry_1
RETURN
OperationDfn: expressionForms.tryExpr::tryExpression.tryExpression()->expressionForms.tryExpr::tryExpression
BasicBlock: _entry_1
CALL (expressionForms.tryExpr::tryExpression)this.i_init() [pure=false, complexity=0]
RETURN this
OperationDfn: expressionForms.tryExpr::tryExpression._call(org.ek9.lang::Integer)->org.ek9.lang::Integer
BasicBlock: _entry_1
SCOPE_ENTER _scope_1
REFERENCE input, org.ek9.lang::Integer
REFERENCE result, org.ek9.lang::Integer
SCOPE_ENTER _scope_2
REFERENCE rtn, org.ek9.lang::Integer
_temp2 = LOAD_LITERAL -1, org.ek9.lang::Integer
RETAIN _temp2
SCOPE_REGISTER _temp2, _scope_2
STORE rtn, _temp2
RETAIN rtn
SCOPE_ENTER _scope_3
CONTROL_FLOW_CHAIN
[
chain_type: "TRY_CATCH_FINALLY"
return_variable: rtn
return_variable_type: "org.ek9.lang::Integer"
return_variable_setup:
[
REFERENCE rtn, org.ek9.lang::Integer
_temp2 = LOAD_LITERAL -1, org.ek9.lang::Integer
RETAIN _temp2
SCOPE_REGISTER _temp2, _scope_2
STORE rtn, _temp2
RETAIN rtn
]
try_block_details:
[
try_scope_id: _scope_4
try_body_evaluation:
[
SCOPE_ENTER _scope_4
_temp4 = LOAD input
RETAIN _temp4
SCOPE_REGISTER _temp4, _scope_4
_temp5 = LOAD_LITERAL 2, org.ek9.lang::Integer
RETAIN _temp5
SCOPE_REGISTER _temp5, _scope_4
_temp3 = CALL (org.ek9.lang::Integer)_temp4._mul(_temp5) [pure=true, complexity=2, effects=RETURN_MUTATION]
RETAIN _temp3
SCOPE_REGISTER _temp3, _scope_4
RELEASE rtn
STORE rtn, _temp3
RETAIN rtn
SCOPE_EXIT _scope_4
]
]
condition_chain:
[
[
case_scope_id: _scope_5
case_type: "EXCEPTION_HANDLER"
condition_evaluation:
[
]
body_evaluation:
[
SCOPE_ENTER _scope_5
REFERENCE ex, org.ek9.lang::Exception
SCOPE_REGISTER ex, _scope_5
_temp6 = LOAD_LITERAL 0, org.ek9.lang::Integer
RETAIN _temp6
SCOPE_REGISTER _temp6, _scope_5
RELEASE rtn
STORE rtn, _temp6
RETAIN rtn
SCOPE_EXIT _scope_5
]
exception_type: "org.ek9.lang::Exception"
exception_variable: ex
]
]
scope_id: _scope_3
]
SCOPE_EXIT _scope_3
SCOPE_EXIT _scope_2
STORE _temp1, rtn
RELEASE rtn
RETAIN _temp1
SCOPE_REGISTER _temp1, _scope_1
RELEASE result
STORE result, _temp1
RETAIN result
SCOPE_EXIT _scope_1
RETURN result`
    tryExpression()
      -> input as Integer
      <- result as Integer?

      //Try expression form - result is assigned the value of rtn when try/catch completes
      result: try
        <- rtn <- -1
        rtn: input * 2
      catch
        -> ex as Exception
        rtn: 0

//EOF
