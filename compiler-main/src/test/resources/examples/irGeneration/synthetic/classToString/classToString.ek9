#!ek9
<?-
  Test synthetic generation of _string ($) operator for a class.

  This test verifies:
  1. The SyntheticOperatorGenerator is invoked for default $ operator
  2. The generated IR correctly:
     - Has guard checking _fieldSetStatus()._empty() at start
     - Returns UNSET String if no fields are set
     - Builds string "ClassName(field1=value1, field2=value2)"
     - SET fields show actual value via field.$()
     - UNSET fields show "?" placeholder
-?>
defines module synthetic.classToString

  @IR: IR_GENERATION: TYPE: "synthetic.classToString::Product": `ConstructDfn: synthetic.classToString::Product
Field: name, org.ek9.lang::String
Field: price, org.ek9.lang::Integer
OperationDfn: synthetic.classToString::Product._isSet()->org.ek9.lang::Boolean
BasicBlock: _entry_1
SCOPE_ENTER __isSet_1
REFERENCE rtn, org.ek9.lang::Boolean
_temp1 = LOAD this.name
RETAIN _temp1
SCOPE_REGISTER _temp1, __isSet_1
_temp2 = CALL (org.ek9.lang::String)_temp1._isSet() [pure=false, complexity=0]
RETAIN _temp2
SCOPE_REGISTER _temp2, __isSet_1
_temp3 = CALL (org.ek9.lang::Boolean)_temp2._true() [pure=false, complexity=0]
RETAIN _temp3
SCOPE_REGISTER _temp3, __isSet_1
BRANCH_TRUE _temp3, _return_true_1
_temp4 = LOAD this.price
RETAIN _temp4
SCOPE_REGISTER _temp4, __isSet_1
_temp5 = CALL (org.ek9.lang::Integer)_temp4._isSet() [pure=false, complexity=0]
RETAIN _temp5
SCOPE_REGISTER _temp5, __isSet_1
_temp6 = CALL (org.ek9.lang::Boolean)_temp5._true() [pure=false, complexity=0]
RETAIN _temp6
SCOPE_REGISTER _temp6, __isSet_1
BRANCH_TRUE _temp6, _return_true_1
BRANCH _return_false_1
LABEL _return_false_1
_temp7 = CALL_STATIC (org.ek9.lang::Boolean)._ofFalse() [pure=false, complexity=0]
RETAIN _temp7
SCOPE_REGISTER _temp7, __isSet_1
STORE rtn, _temp7
RETAIN rtn
SCOPE_EXIT __isSet_1
RETURN rtn
LABEL _return_true_1
_temp8 = CALL_STATIC (org.ek9.lang::Boolean)._ofTrue() [pure=false, complexity=0]
RETAIN _temp8
SCOPE_REGISTER _temp8, __isSet_1
STORE rtn, _temp8
RETAIN rtn
SCOPE_EXIT __isSet_1
RETURN rtn
OperationDfn: synthetic.classToString::Product._fieldSetStatus()->org.ek9.lang::Bits
BasicBlock: _entry_4
SCOPE_ENTER __fieldSetStatus_1
REFERENCE rtn, org.ek9.lang::Bits
_temp38 = LOAD_LITERAL org.ek9.lang::String
RETAIN _temp38
SCOPE_REGISTER _temp38, __fieldSetStatus_1
_temp39 = CALL (org.ek9.lang::Bits)org.ek9.lang::Bits.<init>(_temp38) [pure=false, complexity=0]
RETAIN _temp39
SCOPE_REGISTER _temp39, __fieldSetStatus_1
STORE rtn, _temp39
RETAIN rtn
_temp40 = LOAD this.name
RETAIN _temp40
SCOPE_REGISTER _temp40, __fieldSetStatus_1
_temp41 = CALL (org.ek9.lang::String)_temp40._isSet() [pure=false, complexity=0]
RETAIN _temp41
SCOPE_REGISTER _temp41, __fieldSetStatus_1
CALL (org.ek9.lang::Bits)rtn._addAss(_temp41) [pure=false, complexity=0]
_temp42 = LOAD this.price
RETAIN _temp42
SCOPE_REGISTER _temp42, __fieldSetStatus_1
_temp43 = CALL (org.ek9.lang::Integer)_temp42._isSet() [pure=false, complexity=0]
RETAIN _temp43
SCOPE_REGISTER _temp43, __fieldSetStatus_1
CALL (org.ek9.lang::Bits)rtn._addAss(_temp43) [pure=false, complexity=0]
SCOPE_EXIT __fieldSetStatus_1
RETURN rtn
OperationDfn: synthetic.classToString::Product.Product()->synthetic.classToString::Product
BasicBlock: _entry_3
CALL (synthetic.classToString::Product)this.i_init() [pure=false, complexity=0]
RETURN this
OperationDfn: synthetic.classToString::Product._string()->org.ek9.lang::String
BasicBlock: _entry_2
SCOPE_ENTER __string_1
REFERENCE rtn, org.ek9.lang::String
_temp9 = CALL (synthetic.classToString::Product)this._fieldSetStatus() [pure=false, complexity=0]
RETAIN _temp9
SCOPE_REGISTER _temp9, __string_1
_temp10 = CALL (org.ek9.lang::Bits)_temp9._empty() [pure=false, complexity=0]
RETAIN _temp10
SCOPE_REGISTER _temp10, __string_1
_temp11 = CALL (org.ek9.lang::Boolean)_temp10._true() [pure=false, complexity=0]
RETAIN _temp11
SCOPE_REGISTER _temp11, __string_1
BRANCH_TRUE _temp11, _return_unset_1
LABEL _has_data_1
_temp12 = LOAD_LITERAL Product(, org.ek9.lang::String
RETAIN _temp12
SCOPE_REGISTER _temp12, __string_1
STORE rtn, _temp12
RETAIN rtn
_temp13 = LOAD this.name
RETAIN _temp13
SCOPE_REGISTER _temp13, __string_1
_temp14 = CALL (org.ek9.lang::String)_temp13._isSet() [pure=false, complexity=0]
RETAIN _temp14
SCOPE_REGISTER _temp14, __string_1
_temp15 = CALL (org.ek9.lang::Boolean)_temp14._true() [pure=false, complexity=0]
RETAIN _temp15
SCOPE_REGISTER _temp15, __string_1
BRANCH_FALSE _temp15, _field_unset_1
_temp16 = LOAD_LITERAL name=, org.ek9.lang::String
RETAIN _temp16
SCOPE_REGISTER _temp16, __string_1
_temp17 = CALL (org.ek9.lang::String)rtn._add(_temp16) [pure=false, complexity=0]
RETAIN _temp17
SCOPE_REGISTER _temp17, __string_1
RELEASE rtn
STORE rtn, _temp17
RETAIN rtn
_temp18 = CALL (org.ek9.lang::String)_temp13._string() [pure=false, complexity=0]
RETAIN _temp18
SCOPE_REGISTER _temp18, __string_1
_temp19 = CALL (org.ek9.lang::String)rtn._add(_temp18) [pure=false, complexity=0]
RETAIN _temp19
SCOPE_REGISTER _temp19, __string_1
RELEASE rtn
STORE rtn, _temp19
RETAIN rtn
BRANCH _field_done_1
LABEL _field_unset_1
_temp20 = LOAD_LITERAL name=?, org.ek9.lang::String
RETAIN _temp20
SCOPE_REGISTER _temp20, __string_1
_temp21 = CALL (org.ek9.lang::String)rtn._add(_temp20) [pure=false, complexity=0]
RETAIN _temp21
SCOPE_REGISTER _temp21, __string_1
RELEASE rtn
STORE rtn, _temp21
RETAIN rtn
LABEL _field_done_1
_temp22 = LOAD this.price
RETAIN _temp22
SCOPE_REGISTER _temp22, __string_1
_temp23 = CALL (org.ek9.lang::Integer)_temp22._isSet() [pure=false, complexity=0]
RETAIN _temp23
SCOPE_REGISTER _temp23, __string_1
_temp24 = CALL (org.ek9.lang::Boolean)_temp23._true() [pure=false, complexity=0]
RETAIN _temp24
SCOPE_REGISTER _temp24, __string_1
BRANCH_FALSE _temp24, _field_unset_2
_temp25 = LOAD_LITERAL , , org.ek9.lang::String
RETAIN _temp25
SCOPE_REGISTER _temp25, __string_1
_temp26 = CALL (org.ek9.lang::String)rtn._add(_temp25) [pure=false, complexity=0]
RETAIN _temp26
SCOPE_REGISTER _temp26, __string_1
RELEASE rtn
STORE rtn, _temp26
RETAIN rtn
_temp27 = LOAD_LITERAL price=, org.ek9.lang::String
RETAIN _temp27
SCOPE_REGISTER _temp27, __string_1
_temp28 = CALL (org.ek9.lang::String)rtn._add(_temp27) [pure=false, complexity=0]
RETAIN _temp28
SCOPE_REGISTER _temp28, __string_1
RELEASE rtn
STORE rtn, _temp28
RETAIN rtn
_temp29 = CALL (org.ek9.lang::Integer)_temp22._string() [pure=false, complexity=0]
RETAIN _temp29
SCOPE_REGISTER _temp29, __string_1
_temp30 = CALL (org.ek9.lang::String)rtn._add(_temp29) [pure=false, complexity=0]
RETAIN _temp30
SCOPE_REGISTER _temp30, __string_1
RELEASE rtn
STORE rtn, _temp30
RETAIN rtn
BRANCH _field_done_2
LABEL _field_unset_2
_temp31 = LOAD_LITERAL , , org.ek9.lang::String
RETAIN _temp31
SCOPE_REGISTER _temp31, __string_1
_temp32 = CALL (org.ek9.lang::String)rtn._add(_temp31) [pure=false, complexity=0]
RETAIN _temp32
SCOPE_REGISTER _temp32, __string_1
RELEASE rtn
STORE rtn, _temp32
RETAIN rtn
_temp33 = LOAD_LITERAL price=?, org.ek9.lang::String
RETAIN _temp33
SCOPE_REGISTER _temp33, __string_1
_temp34 = CALL (org.ek9.lang::String)rtn._add(_temp33) [pure=false, complexity=0]
RETAIN _temp34
SCOPE_REGISTER _temp34, __string_1
RELEASE rtn
STORE rtn, _temp34
RETAIN rtn
LABEL _field_done_2
_temp35 = LOAD_LITERAL ), org.ek9.lang::String
RETAIN _temp35
SCOPE_REGISTER _temp35, __string_1
_temp36 = CALL (org.ek9.lang::String)rtn._add(_temp35) [pure=false, complexity=0]
RETAIN _temp36
SCOPE_REGISTER _temp36, __string_1
RELEASE rtn
STORE rtn, _temp36
RETAIN rtn
BRANCH _return_string_1
LABEL _return_unset_1
_temp37 = CALL (org.ek9.lang::String)org.ek9.lang::String.<init>() [pure=false, complexity=0]
RETAIN _temp37
SCOPE_REGISTER _temp37, __string_1
STORE rtn, _temp37
RETAIN rtn
SCOPE_EXIT __string_1
RETURN rtn
LABEL _return_string_1
SCOPE_EXIT __string_1
RETURN rtn
OperationDfn: synthetic.classToString::Product.c_init()->org.ek9.lang::Void
BasicBlock: _entry_1
RETURN
OperationDfn: synthetic.classToString::Product.i_init()->org.ek9.lang::Void
BasicBlock: _entry_1
REFERENCE this.name, org.ek9.lang::String
_temp1 = LOAD_LITERAL Gadget, org.ek9.lang::String
RETAIN _temp1
SCOPE_REGISTER _temp1, i_init
STORE this.name, _temp1
RETAIN this.name
REFERENCE this.price, org.ek9.lang::Integer
_temp2 = LOAD_LITERAL 50, org.ek9.lang::Integer
RETAIN _temp2
SCOPE_REGISTER _temp2, i_init
STORE this.price, _temp2
RETAIN this.price
RETURN`

  defines class

    Product
      name <- "Gadget"
      price <- 50

      default operator ?
      default operator $

//EOF
