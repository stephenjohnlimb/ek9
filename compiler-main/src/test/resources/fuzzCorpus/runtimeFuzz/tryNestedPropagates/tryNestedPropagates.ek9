#!ek9
<?-
  Runtime fuzz test: 2-level nested try, inner has only finally.

  Tests that exception propagates through inner finally to outer catch.
  Inner finally MUST run before outer catch executes.

  Structure: try { try { THROW } finally { cleanup } } catch { handle }
-?>
defines module fuzz.runtime.try.nested.propagates

  defines program

    TryNestedPropagates()
      stdout <- Stdout()

      try
        stdout.println("Outer try: start")
        try
          stdout.println("Inner try: about to throw")
          ex <- Exception("Propagating exception")
          throw ex
        finally
          stdout.println("Inner finally: cleanup before propagation")
      catch
        -> e as Exception
        stdout.println("Outer catch: caught propagated exception")

      stdout.println("Done")

//EOF
