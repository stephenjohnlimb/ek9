#!ek9
<?-
  Runtime fuzz test: 2-level nested try, both have finally blocks.

  Tests that when inner catch handles exception, BOTH finally blocks run.
  Order must be: inner finally first, then outer finally.

  Structure: try { try { THROW } catch finally } catch finally
-?>
defines module fuzz.runtime.try.nested.bothfinally

  defines program

    TryNestedBothFinally()
      stdout <- Stdout()

      try
        stdout.println("Outer try: start")
        try
          stdout.println("Inner try: about to throw")
          ex <- Exception("Test exception")
          throw ex
        catch
          -> e as Exception
          stdout.println("Inner catch: handled")
        finally
          stdout.println("Inner finally: runs first")
        stdout.println("Outer try: after inner block")
      catch
        -> e as Exception
        stdout.println("ERROR: Outer catch should not execute")
      finally
        stdout.println("Outer finally: runs second")

      stdout.println("Done")

//EOF
