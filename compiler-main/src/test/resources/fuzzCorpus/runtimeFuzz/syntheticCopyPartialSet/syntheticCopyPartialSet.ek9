#!ek9
<?-
  Runtime fuzz test: Synthetic :=: operator - copy from partially set object.

  Tests that when copying from an object with some fields set,
  the partial state is correctly preserved in the destination.
-?>
defines module fuzz.runtime.synthetic.copy.partialset

  defines class

    TestPoint
      x <- Integer()
      y <- Integer()
      z <- Integer()

      TestPoint()
        ->
          xVal as Integer
        this.x :=: xVal
        //y and z remain unset

      default operator ?
      default operator $
      default operator :=:

  defines program

    SyntheticCopyPartialSet()
      stdout <- Stdout()

      stdout.println("Test: Synthetic :=: copy from partially set object")

      //Create source with partial fields set (x set, y and z unset)
      src <- TestPoint(10)

      //Create empty destination
      dst <- TestPoint()

      stdout.println("Before copy:")
      stdout.println("src: " + $src)
      stdout.println("dst: " + $dst)
      stdout.println("src?: " + $src?)
      stdout.println("dst?: " + $dst?)

      //Copy from source to destination
      dst :=: src

      stdout.println("After copy:")
      stdout.println("src: " + $src)
      stdout.println("dst: " + $dst)
      stdout.println("dst?: " + $dst?)

      stdout.println("Test complete")

//EOF
