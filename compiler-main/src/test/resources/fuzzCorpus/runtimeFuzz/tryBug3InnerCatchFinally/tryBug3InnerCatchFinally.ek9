#!ek9
<?-
  Runtime fuzz test: Bug #3 Variation - Inner has both catch AND finally.

  Tests pattern where inner try has BOTH catch AND finally,
  and outer try also has BOTH catch AND finally.
  Exception is caught at inner level, so outer catch should NOT execute.

  Pattern: try { try { THROW } catch finally } catch finally
-?>
defines module fuzz.runtime.try.bug3.innercatchfinally

  defines program

    TryBug3InnerCatchFinally()
      stdout <- Stdout()

      stdout.println("Starting test")

      try
        stdout.println("Outer try: start")
        try
          stdout.println("Inner try: about to throw")
          ex <- Exception("Test exception")
          throw ex
        catch
          -> e as Exception
          stdout.println("Inner catch: caught exception")
        finally
          stdout.println("Inner finally: cleanup")
        stdout.println("Outer try: after inner block")
      catch
        -> e as Exception
        stdout.println("ERROR: Outer catch should not execute")
      finally
        stdout.println("Outer finally: cleanup")

      stdout.println("Done")

//EOF
