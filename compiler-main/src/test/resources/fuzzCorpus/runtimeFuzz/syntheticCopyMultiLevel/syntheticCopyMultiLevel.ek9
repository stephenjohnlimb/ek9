#!ek9
<?-
  Runtime fuzz test: Synthetic :=: operator - multi-level nesting copy.

  Tests shallow copy with 3 levels of nesting: Outer -> Middle -> Inner
  Proves shallow copy propagates correctly through multiple levels.
-?>
defines module fuzz.runtime.synthetic.copy.multilevel

  defines class

    Inner
      value <- Integer()

      Inner()
        -> v as Integer
        this.value :=: v

      setValue()
        -> v as Integer
        this.value :=: v

      default operator ?
      default operator $
      default operator :=:

    Middle
      inner <- Inner()

      Middle()
        -> i as Inner
        this.inner :=: i

      default operator ?
      default operator $
      default operator :=:

    Outer
      middle <- Middle()

      Outer()
        -> m as Middle
        this.middle :=: m

      default operator ?
      default operator $
      default operator :=:

  defines program

    SyntheticCopyMultiLevel()
      stdout <- Stdout()

      stdout.println("Test: Multi-level nesting copy")

      //Create 3-level nested structure
      innerObj <- Inner(100)
      middleObj <- Middle(innerObj)
      src <- Outer(middleObj)

      //Create destination and copy
      dst <- Outer(Middle(Inner(0)))
      dst :=: src

      stdout.println("After copy:")
      stdout.println("src: " + $src)
      stdout.println("dst: " + $dst)

      //Mutate the deepest level through original reference
      innerObj.setValue(999)

      stdout.println("After innerObj.setValue(999):")
      stdout.println("innerObj: " + $innerObj)
      stdout.println("src: " + $src)
      stdout.println("dst: " + $dst)

      stdout.println("Test complete")

//EOF
